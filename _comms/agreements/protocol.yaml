# ============================================================
# ECS MMORPG Packet Protocol v2.0
# Single Source of Truth - Server Implementation Based
# ============================================================
# Generated from: PacketComponents.h + SERVER_IMPLEMENTATION_SUMMARY.md
# Server: 29 sessions, 321 tests passing
# Total: 96 message types (57 unique + duplicates counted per direction)
# ============================================================

version: "2.0"
generated: "2026-02-12"
source: "server-agent (PacketComponents.h)"

header:
  format: "[length:u32][msg_type:u16][payload:variable]"
  header_size: 6
  byte_order: little-endian
  max_packet: 8192

# ============================================================
# Sessions 1-2: Core Infrastructure
# ============================================================
messages:

  ECHO:
    id: 1
    session: 1
    direction: bidirectional
    payload:
      - { name: data, type: bytes, size: variable }

  PING:
    id: 2
    session: 2
    direction: C2S
    payload: []
    note: "response is PONG (same id)"

  STATS:
    id: 99
    session: 2
    direction: S2C
    payload:
      - { name: diagnostics, type: bytes, size: variable }

# ============================================================
# Sessions 3-4: Movement & AOI
# ============================================================

  MOVE:
    id: 10
    session: 3
    direction: C2S
    payload:
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
      - { name: timestamp, type: u32, optional: true }
    total_size: "12 (legacy) or 16 (Model C)"
    note: "Session 35: timestamp 추가 (선택). 서버는 12/16 둘 다 수용. 초당 10회 전송 권장."

  MOVE_BROADCAST:
    id: 11
    session: 3
    direction: S2C
    payload:
      - { name: entity, type: u64 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 20

  POS_QUERY:
    id: 12
    session: 3
    direction: C2S
    payload: []

  POSITION_CORRECTION:
    id: 15
    session: 35
    direction: S2C
    payload:
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 12
    note: "서버가 핵 감지 or 존 이탈 시 강제 위치 보정. 클라는 즉시 이 좌표로 텔레포트."

  APPEAR:
    id: 13
    session: 4
    direction: S2C
    payload:
      - { name: entity, type: u64 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 20

  DISAPPEAR:
    id: 14
    session: 4
    direction: S2C
    payload:
      - { name: entity, type: u64 }
    total_size: 8

# ============================================================
# Sessions 5-6: Channel & Zone
# ============================================================

  CHANNEL_JOIN:
    id: 20
    session: 5
    direction: C2S
    payload:
      - { name: channel_id, type: i32 }
    total_size: 4

  CHANNEL_INFO:
    id: 22
    session: 5
    direction: S2C
    payload:
      - { name: channel_id, type: i32 }
    total_size: 4

  ZONE_ENTER:
    id: 30
    session: 6
    direction: C2S
    payload:
      - { name: zone_id, type: i32 }
    total_size: 4

  ZONE_INFO:
    id: 31
    session: 6
    direction: S2C
    payload:
      - { name: zone_id, type: i32 }
    total_size: 4

# ============================================================
# Sessions 7-8: Server Handoff & Ghost
# ============================================================

  HANDOFF_REQUEST:
    id: 40
    session: 7
    direction: C2S
    payload: []

  HANDOFF_DATA:
    id: 41
    session: 7
    direction: S2C
    payload:
      - { name: serialized_entity, type: bytes, size: variable }

  HANDOFF_RESTORE:
    id: 42
    session: 7
    direction: C2S
    payload:
      - { name: serialized_entity, type: bytes, size: variable }

  HANDOFF_RESULT:
    id: 43
    session: 7
    direction: S2C
    payload:
      - { name: zone, type: i32 }
      - { name: channel, type: i32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 20

  GHOST_QUERY:
    id: 50
    session: 8
    direction: C2S
    payload: []

  GHOST_INFO:
    id: 51
    session: 8
    direction: S2C
    payload:
      - { name: ghost_count, type: i32 }
    total_size: 4

# ============================================================
# Session 9: Authentication & Character
# ============================================================

  LOGIN:
    id: 60
    session: 9
    direction: C2S
    payload:
      - { name: uname_len, type: u8 }
      - { name: username, type: string, size: variable }
      - { name: pw_len, type: u8 }
      - { name: password, type: string, size: variable }

  LOGIN_RESULT:
    id: 61
    session: 9
    direction: S2C
    payload:
      - { name: result, type: u8, enum: LoginResult }
      - { name: account_id, type: u32 }
    total_size: 5

  CHAR_LIST_REQ:
    id: 62
    session: 9
    direction: C2S
    payload: []

  CHAR_LIST_RESP:
    id: 63
    session: 9
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: characters
        type: array
        entry_size: 44
        fields:
          - { name: id, type: u32 }
          - { name: name, type: string_fixed, size: 32 }
          - { name: level, type: u32 }
          - { name: job, type: u32 }

  CHAR_SELECT:
    id: 64
    session: 9
    direction: C2S
    payload:
      - { name: char_id, type: u32 }
    total_size: 4

  ENTER_GAME:
    id: 65
    session: 9
    direction: S2C
    payload:
      - { name: result, type: u8, enum: EnterGameResult }
      - { name: entity, type: u64 }
      - { name: zone, type: u32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 25
    note: "Stats sent separately via STAT_SYNC(91)"

# ============================================================
# Sessions 10, 17: Gate Server
# ============================================================

  GATE_ROUTE_REQ:
    id: 70
    session: 10
    direction: C2S
    payload: []

  GATE_ROUTE_RESP:
    id: 71
    session: 10
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: port, type: u16 }
      - { name: ip_len, type: u8 }
      - { name: ip, type: string, size: variable }

  FIELD_REGISTER:
    id: 130
    session: 17
    direction: server2server
    payload:
      - { name: port, type: u16 }
      - { name: max_ccu, type: u32 }
      - { name: name_len, type: u8 }
      - { name: name, type: string, size: variable }

  FIELD_HEARTBEAT:
    id: 131
    session: 17
    direction: server2server
    payload:
      - { name: port, type: u16 }
      - { name: ccu, type: u32 }
      - { name: max_ccu, type: u32 }
    total_size: 10

  GATE_SERVER_LIST:
    id: 133
    session: 17
    direction: C2S
    payload: []

  GATE_SERVER_LIST_RESP:
    id: 134
    session: 17
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: servers
        type: array
        entry_size: 11
        fields:
          - { name: port, type: u16 }
          - { name: ccu, type: u32 }
          - { name: max_ccu, type: u32 }
          - { name: status, type: u8 }

# ============================================================
# Session 11: Timers & Config
# ============================================================

  TIMER_ADD:
    id: 80
    session: 11
    direction: C2S
    payload:
      - { name: timer_id, type: u32 }
      - { name: duration_ms, type: u32 }
      - { name: interval_ms, type: u32 }
    total_size: 12

  TIMER_INFO:
    id: 81
    session: 11
    direction: S2C
    payload:
      - { name: active_timer_count, type: u32 }
      - { name: total_events_fired, type: u32 }
    total_size: 8

  CONFIG_QUERY:
    id: 82
    session: 11
    direction: C2S
    payload:
      - { name: table_name_len, type: u8 }
      - { name: table_name, type: string, size: variable }
      - { name: key_col, type: u8 }
      - { name: key, type: string, size: variable }

  CONFIG_RESP:
    id: 83
    session: 11
    direction: S2C
    payload:
      - { name: found, type: u8 }
      - { name: data_len, type: u16 }
      - { name: data, type: bytes, size: variable }

# ============================================================
# Session 12: Stats
# ============================================================

  STAT_QUERY:
    id: 90
    session: 12
    direction: C2S
    payload: []

  STAT_SYNC:
    id: 91
    session: 12
    direction: S2C
    payload:
      - { name: level, type: i32 }
      - { name: hp, type: i32 }
      - { name: max_hp, type: i32 }
      - { name: mp, type: i32 }
      - { name: max_mp, type: i32 }
      - { name: atk, type: i32 }
      - { name: def, type: i32 }
      - { name: exp, type: i32 }
      - { name: exp_next, type: i32 }
    total_size: 36

  STAT_ADD_EXP:
    id: 92
    session: 12
    direction: C2S
    payload:
      - { name: exp_amount, type: i32 }
    total_size: 4

  STAT_TAKE_DMG:
    id: 93
    session: 12
    direction: C2S
    payload:
      - { name: raw_damage, type: i32 }
    total_size: 4

  STAT_HEAL:
    id: 94
    session: 12
    direction: C2S
    payload:
      - { name: heal_amount, type: i32 }
    total_size: 4

# ============================================================
# Session 13: Combat
# ============================================================

  ATTACK_REQ:
    id: 100
    session: 13
    direction: C2S
    payload:
      - { name: target_entity, type: u64 }
    total_size: 8

  ATTACK_RESULT:
    id: 101
    session: 13
    direction: S2C
    payload:
      - { name: result, type: u8, enum: AttackResult }
      - { name: attacker, type: u64 }
      - { name: target, type: u64 }
      - { name: damage, type: i32 }
      - { name: target_hp, type: i32 }
      - { name: target_max_hp, type: i32 }
    total_size: 29

  COMBAT_DIED:
    id: 102
    session: 13
    direction: S2C
    payload:
      - { name: dead_entity, type: u64 }
      - { name: killer_entity, type: u64 }
    total_size: 16

  RESPAWN_REQ:
    id: 103
    session: 13
    direction: C2S
    payload: []

  RESPAWN_RESULT:
    id: 104
    session: 13
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: hp, type: i32 }
      - { name: mp, type: i32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 21

# ============================================================
# Session 14: Monsters
# ============================================================

  MONSTER_SPAWN:
    id: 110
    session: 14
    direction: S2C
    payload:
      - { name: entity, type: u64 }
      - { name: monster_id, type: u32 }
      - { name: level, type: u32 }
      - { name: hp, type: i32 }
      - { name: max_hp, type: i32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 36

  MONSTER_MOVE:
    id: 111
    session: 36
    direction: S2C
    payload:
      - { name: entity, type: u64 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 20
    note: "몬스터 이동 브로드캐스트 (순찰/추적/귀환 시). 200ms 간격."

  MONSTER_AGGRO:
    id: 112
    session: 36
    direction: S2C
    payload:
      - { name: monster_entity, type: u64 }
      - { name: target_entity, type: u64 }
    total_size: 16
    note: "어그로 타겟 변경. target=0이면 어그로 해제 (귀환 중)."

  MONSTER_RESPAWN:
    id: 113
    session: 14
    direction: S2C
    payload:
      - { name: entity, type: u64 }
      - { name: hp, type: i32 }
      - { name: max_hp, type: i32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 28

# ============================================================
# Session 36: Monster AI Rules
# ============================================================

monster_ai:
  fsm_states:
    IDLE: 0      # 대기: 주변 감지 + 순찰 전환
    PATROL: 1    # 순찰: 스폰 주변 이동
    CHASE: 2     # 추적: 어그로 타겟 추적
    ATTACK: 3    # 공격: 사거리 내 공격
    RETURN: 4    # 귀환: 스폰 복귀 + HP 회복
    DEAD: 5      # 사망: 리스폰 대기

  movement:
    move_speed: 80.0          # 기본 이동속도 (units/sec)
    chase_speed_mult: 1.3     # 추적 속도 배율
    patrol_radius: 100.0      # 순찰 반경
    arrival_threshold: 10.0   # 도착 판정 거리

  combat:
    leash_range: 500.0        # 귀환 트리거 거리
    attack_range: 200.0       # 공격 사거리
    attack_cooldown: 2.0      # 공격 쿨다운 (초)
    return_heal_rate: 0.1     # 귀환 중 HP 회복률 (초당 max_hp의 10%)

  aggro:
    max_entries: 8            # 최대 어그로 테이블 크기
    detection_threat: 1.0     # 감지 시 초기 위협도
    damage_threat: "damage"   # 데미지 = 위협도
    note: "탑 어그로 타겟팅. 리쉬/귀환 시 테이블 초기화."

  broadcast:
    move_interval: 0.2        # 이동 브로드캐스트 간격 (초)
    aggro_change: "즉시"       # 어그로 변경 시 즉시 전송

# ============================================================
# Session 16: Zone Transfer
# ============================================================

  ZONE_TRANSFER_REQ:
    id: 120
    session: 16
    direction: C2S
    payload:
      - { name: target_zone_id, type: i32 }
    total_size: 4

  ZONE_TRANSFER_RESULT:
    id: 121
    session: 16
    direction: S2C
    payload:
      - { name: result, type: u8, enum: ZoneTransferResult }
      - { name: zone_id, type: u32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 17

# ============================================================
# Session 19: Skills
# ============================================================

  SKILL_LIST_REQ:
    id: 150
    session: 19
    direction: C2S
    payload: []

  SKILL_LIST_RESP:
    id: 151
    session: 19
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: skills
        type: array
        entry_size: 37
        fields:
          - { name: id, type: u32 }
          - { name: name, type: string_fixed, size: 16 }
          - { name: cd_ms, type: u32 }
          - { name: dmg, type: u32 }
          - { name: mp, type: u32 }
          - { name: range, type: u32 }
          - { name: type, type: u8 }

  SKILL_USE:
    id: 152
    session: 19
    direction: C2S
    payload:
      - { name: skill_id, type: u32 }
      - { name: target_entity, type: u64 }
    total_size: 12

  SKILL_RESULT:
    id: 153
    session: 19
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: skill_id, type: u32 }
      - { name: caster, type: u64 }
      - { name: target, type: u64 }
      - { name: damage, type: i32 }
      - { name: target_hp, type: i32 }
    total_size: 29

# ============================================================
# Session 20: Party
# ============================================================

  PARTY_CREATE:
    id: 160
    session: 20
    direction: C2S
    payload: []

  PARTY_INVITE:
    id: 161
    session: 20
    direction: C2S
    payload:
      - { name: target_entity, type: u64 }
    total_size: 8

  PARTY_ACCEPT:
    id: 162
    session: 20
    direction: C2S
    payload:
      - { name: party_id, type: u32 }
    total_size: 4

  PARTY_LEAVE:
    id: 163
    session: 20
    direction: C2S
    payload: []

  PARTY_INFO:
    id: 164
    session: 20
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: party_id, type: u32 }
      - { name: leader, type: u64 }
      - { name: count, type: u8 }
      - name: members
        type: array
        entry_size: 12
        fields:
          - { name: entity, type: u64 }
          - { name: level, type: u32 }

  PARTY_KICK:
    id: 165
    session: 20
    direction: C2S
    payload:
      - { name: target_entity, type: u64 }
    total_size: 8

# ============================================================
# Session 21: Instanced Dungeons
# ============================================================

  INSTANCE_CREATE:
    id: 170
    session: 21
    direction: C2S
    payload:
      - { name: dungeon_type, type: u32 }
    total_size: 4

  INSTANCE_ENTER:
    id: 171
    session: 21
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: instance_id, type: u32 }
      - { name: dungeon_type, type: u32 }
    total_size: 9

  INSTANCE_LEAVE:
    id: 172
    session: 21
    direction: C2S
    payload: []

  INSTANCE_LEAVE_RESULT:
    id: 173
    session: 21
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: zone_id, type: u32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
    total_size: 17

  INSTANCE_INFO:
    id: 174
    session: 21
    direction: S2C
    payload:
      - { name: instance_id, type: u32 }
      - { name: dungeon_type, type: u32 }
      - { name: player_count, type: u8 }
      - { name: monster_count, type: u8 }
    total_size: 10

# ============================================================
# Session 22: Matchmaking
# ============================================================

  MATCH_ENQUEUE:
    id: 180
    session: 22
    direction: C2S
    payload:
      - { name: dungeon_type, type: u32 }
    total_size: 4

  MATCH_DEQUEUE:
    id: 181
    session: 22
    direction: C2S
    payload: []

  MATCH_FOUND:
    id: 182
    session: 22
    direction: S2C
    payload:
      - { name: match_id, type: u32 }
      - { name: dungeon_type, type: u32 }
      - { name: player_count, type: u8 }
    total_size: 9

  MATCH_ACCEPT:
    id: 183
    session: 22
    direction: C2S
    payload:
      - { name: match_id, type: u32 }
    total_size: 4

  MATCH_STATUS:
    id: 184
    session: 22
    direction: S2C
    payload:
      - { name: status, type: u8 }
      - { name: queue_position, type: u32 }
    total_size: 5

# ============================================================
# Session 23: Inventory
# ============================================================

  INVENTORY_REQ:
    id: 190
    session: 23
    direction: C2S
    payload: []

  INVENTORY_RESP:
    id: 191
    session: 23
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: items
        type: array
        entry_size: 8
        fields:
          - { name: slot, type: u8 }
          - { name: item_id, type: u32 }
          - { name: count, type: u16 }
          - { name: equipped, type: u8 }

  ITEM_ADD:
    id: 192
    session: 23
    direction: C2S
    payload:
      - { name: item_id, type: u32 }
      - { name: count, type: u16 }
    total_size: 6

  ITEM_ADD_RESULT:
    id: 193
    session: 23
    direction: S2C
    payload:
      - { name: result, type: u8, enum: ItemResult }
      - { name: slot, type: u8 }
      - { name: item_id, type: u32 }
      - { name: count, type: u16 }
    total_size: 8

  ITEM_USE:
    id: 194
    session: 23
    direction: C2S
    payload:
      - { name: slot, type: u8 }
    total_size: 1

  ITEM_USE_RESULT:
    id: 195
    session: 23
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: slot, type: u8 }
      - { name: item_id, type: u32 }
    total_size: 6

  ITEM_EQUIP:
    id: 196
    session: 23
    direction: C2S
    payload:
      - { name: slot, type: u8 }
    total_size: 1

  ITEM_UNEQUIP:
    id: 197
    session: 23
    direction: C2S
    payload:
      - { name: slot, type: u8 }
    total_size: 1

  ITEM_EQUIP_RESULT:
    id: 198
    session: 23
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: slot, type: u8 }
      - { name: item_id, type: u32 }
      - { name: equipped, type: u8 }
    total_size: 7

# ============================================================
# Session 24: Buffs
# ============================================================

  BUFF_LIST_REQ:
    id: 200
    session: 24
    direction: C2S
    payload: []

  BUFF_LIST_RESP:
    id: 201
    session: 24
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: buffs
        type: array
        entry_size: 9
        fields:
          - { name: buff_id, type: u32 }
          - { name: remaining_ms, type: u32 }
          - { name: stacks, type: u8 }

  BUFF_APPLY_REQ:
    id: 202
    session: 24
    direction: C2S
    payload:
      - { name: buff_id, type: u32 }
    total_size: 4

  BUFF_RESULT:
    id: 203
    session: 24
    direction: S2C
    payload:
      - { name: result, type: u8, enum: BuffResult }
      - { name: buff_id, type: u32 }
      - { name: stacks, type: u8 }
      - { name: duration_ms, type: u32 }
    total_size: 10

  BUFF_REMOVE_REQ:
    id: 204
    session: 24
    direction: C2S
    payload:
      - { name: buff_id, type: u32 }
    total_size: 4

  BUFF_REMOVE_RESP:
    id: 205
    session: 24
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: buff_id, type: u32 }
    total_size: 5

# ============================================================
# Session 25: Condition Engine
# ============================================================

  CONDITION_EVAL:
    id: 210
    session: 25
    direction: C2S
    payload:
      - { name: node_count, type: u8 }
      - { name: root, type: u8 }
      - name: nodes
        type: array
        entry_size: 13
        fields:
          - { name: type, type: u8 }
          - { name: p1, type: i32 }
          - { name: p2, type: i32 }
          - { name: left, type: u16 }
          - { name: right, type: u16 }

  CONDITION_RESULT:
    id: 211
    session: 25
    direction: S2C
    payload:
      - { name: result, type: u8 }
    total_size: 1

# ============================================================
# Session 26: Spatial Queries
# ============================================================

  SPATIAL_QUERY_REQ:
    id: 215
    session: 26
    direction: C2S
    payload:
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
      - { name: radius, type: f32 }
      - { name: filter, type: u8, enum: SpatialFilter }
    total_size: 17

  SPATIAL_QUERY_RESP:
    id: 216
    session: 26
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: results
        type: array
        entry_size: 12
        fields:
          - { name: entity, type: u64 }
          - { name: dist, type: f32 }

# ============================================================
# Session 27: Loot
# ============================================================

  LOOT_ROLL_REQ:
    id: 220
    session: 27
    direction: C2S
    payload:
      - { name: table_id, type: u32 }
    total_size: 4

  LOOT_RESULT:
    id: 221
    session: 27
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: items
        type: array
        entry_size: 6
        fields:
          - { name: item_id, type: u32 }
          - { name: count, type: u16 }

# ============================================================
# Session 28: Quests
# ============================================================

  QUEST_LIST_REQ:
    id: 230
    session: 28
    direction: C2S
    payload: []

  QUEST_LIST_RESP:
    id: 231
    session: 28
    direction: S2C
    payload:
      - { name: count, type: u8 }
      - name: quests
        type: array
        entry_size: 13
        fields:
          - { name: quest_id, type: u32 }
          - { name: state, type: u8, enum: QuestState }
          - { name: progress, type: u32 }
          - { name: target, type: u32 }

  QUEST_ACCEPT:
    id: 232
    session: 28
    direction: C2S
    payload:
      - { name: quest_id, type: u32 }
    total_size: 4

  QUEST_ACCEPT_RESULT:
    id: 233
    session: 28
    direction: S2C
    payload:
      - { name: result, type: u8, enum: QuestAcceptResult }
      - { name: quest_id, type: u32 }
    total_size: 5

  QUEST_PROGRESS:
    id: 234
    session: 28
    direction: C2S
    payload:
      - { name: quest_id, type: u32 }
    total_size: 4

  QUEST_COMPLETE:
    id: 235
    session: 28
    direction: C2S
    payload:
      - { name: quest_id, type: u32 }
    total_size: 4

  QUEST_COMPLETE_RESULT:
    id: 236
    session: 28
    direction: S2C
    payload:
      - { name: result, type: u8 }
      - { name: quest_id, type: u32 }
      - { name: reward_exp, type: u32 }
      - { name: reward_item_id, type: u32 }
      - { name: reward_item_count, type: u16 }
    total_size: 15

# ============================================================
# Result Code Enums
# ============================================================

result_codes:
  LoginResult:
    0: SUCCESS
    1: ACCOUNT_NOT_FOUND
    2: WRONG_PASSWORD
    3: ALREADY_ONLINE

  EnterGameResult:
    0: SUCCESS
    1: CHAR_NOT_FOUND
    2: DIFFERENT_ACCOUNT

  AttackResult:
    0: SUCCESS
    1: TARGET_NOT_FOUND
    2: TARGET_DEAD
    3: OUT_OF_RANGE
    4: COOLDOWN
    5: ATTACKER_DEAD
    6: SELF_ATTACK

  ZoneTransferResult:
    0: SUCCESS
    1: ZONE_NOT_EXIST
    2: ALREADY_SAME_ZONE

  ItemResult:
    0: SUCCESS
    1: INVENTORY_FULL
    2: EMPTY_SLOT
    3: ALREADY_EQUIPPED
    4: CANNOT_EQUIP

  BuffResult:
    0: SUCCESS
    1: BUFF_NOT_FOUND
    2: NO_SLOT
    3: INACTIVE

  QuestState:
    0: NONE
    1: ACCEPTED
    2: IN_PROGRESS
    3: COMPLETE
    4: REWARDED

  QuestAcceptResult:
    0: SUCCESS
    1: QUEST_NOT_FOUND
    2: ALREADY_ACCEPTED
    3: QUEST_FULL
    4: PREREQUISITES_NOT_MET
    5: LEVEL_TOO_LOW
    6: INCOMPLETE

  SpatialFilter:
    0: ALL
    1: PLAYERS_ONLY
    2: MONSTERS_ONLY

  ConditionType:
    0: ALWAYS_TRUE
    1: ALWAYS_FALSE
    10: AND
    11: OR
    12: NOT
    20: LEVEL_GE
    30: HAS_ITEM
    31: HAS_BUFF
    40: IN_ZONE
    60: CLASS_EQ

  ShopResult:
    0: SUCCESS
    1: SHOP_NOT_FOUND
    2: ITEM_NOT_FOUND
    3: NOT_ENOUGH_GOLD
    4: INVENTORY_FULL
    5: OUT_OF_STOCK
    6: EMPTY_SLOT
    7: INVALID_COUNT

  ShopAction:
    0: BUY
    1: SELL

  WhisperResult:
    0: SUCCESS
    1: TARGET_NOT_FOUND
    2: TARGET_OFFLINE

  WhisperDirection:
    0: RECEIVED
    1: SENT

  ChatChannel:
    0: GENERAL
    1: PARTY
    2: WHISPER
    3: SYSTEM

  SkillLevelUpResult:
    0: SUCCESS
    1: NO_SKILL_POINTS
    2: SKILL_NOT_FOUND
    3: MAX_LEVEL
    4: LEVEL_TOO_LOW
    5: SLOTS_FULL

  SkillEffect:
    0: DAMAGE
    1: SELF_HEAL
    2: SELF_BUFF
    3: AOE_DAMAGE
    4: DOT_DAMAGE

  BossAttackType:
    0: GROUND_SLAM
    1: FIRE_BREATH
    2: TAIL_SWIPE
    3: SUMMON_ADDS
    4: STOMP
    5: DARK_NOVA

  BossEventType:
    0: PHASE_CHANGE
    1: SPECIAL_ATTACK
    2: ENRAGE
    3: DEFEATED

# ============================================================
# Session 35: Movement Rules (Model C - 서버+클라 공유)
# ============================================================
# 서버와 클라이언트가 반드시 동일한 값을 사용해야 함.
# 서버: 이 값으로 이동 검증 (스피드핵 감지)
# 클라: 이 값으로 캐릭터 이동속도 설정

movement_rules:
  base_speed: 200.0              # 기본 이동속도 (units/sec)
  sprint_multiplier: 1.5         # 달리기 배율
  mount_multiplier: 2.0          # 탈것 배율
  server_tolerance: 1.5          # 서버 검증 여유값 (50% - 네트워크 지터 허용)
  update_rate_hz: 10             # 초당 위치 전송 횟수 (클라→서버)
  correction_threshold: 50.0     # 이 거리(units) 이상 차이나면 보정 전송
  max_violations: 5              # 연속 위반 허용 횟수 (초과 시 킥)
  max_valid_coord: 10000.0       # 좌표 절대값 최대

  zone_bounds:                   # 존별 이동 가능 범위
    - { zone_id: 1, min_x: 0, min_y: 0, max_x: 1000, max_y: 1000 }
    - { zone_id: 2, min_x: 0, min_y: 0, max_x: 2000, max_y: 2000 }
    - { zone_id: 3, min_x: 0, min_y: 0, max_x: 3000, max_y: 3000 }

  client_responsibilities:
    - "내 캐릭터: 로컬 즉시 이동 (입력 반응성)"
    - "초당 10회 MOVE 패킷 전송 (100ms 간격)"
    - "POSITION_CORRECTION 수신 시 즉시 해당 좌표로 텔레포트"
    - "다른 플레이어: MOVE_BROADCAST 받아서 Lerp 보간"
    - "이동속도 = base_speed * (sprint/mount) multiplier"

  server_responsibilities:
    - "MOVE 수신 → 속도/경계/좌표 검증"
    - "검증 실패 → POSITION_CORRECTION 전송"
    - "검증 성공 → 위치 저장 + MOVE_BROADCAST"
    - "연속 5회 위반 시 세션 킥"

# ============================================================
# Session 30: Chat System
# ============================================================

  CHAT_SEND:
    id: 240
    session: 30
    direction: C2S
    payload:
      - { name: channel, type: u8, enum: ChatChannel }
      - { name: msg_len, type: u8 }
      - { name: message, type: bytes, size: variable }
    note: "channel 0=zone broadcast, 1=party only"

  CHAT_MESSAGE:
    id: 241
    session: 30
    direction: S2C
    payload:
      - { name: channel, type: u8, enum: ChatChannel }
      - { name: sender_entity, type: u64 }
      - { name: sender_name, type: string_fixed, size: 32 }
      - { name: msg_len, type: u8 }
      - { name: message, type: bytes, size: variable }
    note: "Fixed header: 1+8+32+1 = 42 bytes + variable message"

  WHISPER_SEND:
    id: 242
    session: 30
    direction: C2S
    payload:
      - { name: target_name_len, type: u8 }
      - { name: target_name, type: string, size: variable }
      - { name: msg_len, type: u8 }
      - { name: message, type: bytes, size: variable }

  WHISPER_RESULT:
    id: 243
    session: 30
    direction: S2C
    payload:
      - { name: result, type: u8, enum: WhisperResult }
      - { name: direction, type: u8, enum: WhisperDirection }
      - { name: other_name, type: string_fixed, size: 32 }
      - { name: msg_len, type: u8 }
      - { name: message, type: bytes, size: variable }
    note: "direction 0=received whisper, 1=sent echo. other_name is sender(for received) or target(for sent)"

  SYSTEM_MESSAGE:
    id: 244
    session: 30
    direction: S2C
    payload:
      - { name: msg_len, type: u8 }
      - { name: message, type: bytes, size: variable }

# ============================================================
# Session 32: NPC Shop
# ============================================================

  SHOP_OPEN:
    id: 250
    session: 32
    direction: C2S
    payload:
      - { name: npc_id, type: i32 }
    total_size: 4

  SHOP_LIST:
    id: 251
    session: 32
    direction: S2C
    payload:
      - { name: npc_id, type: i32 }
      - { name: count, type: u8 }
      - name: items
        type: array
        entry_size: 10
        fields:
          - { name: item_id, type: i32 }
          - { name: price, type: i32 }
          - { name: stock, type: i16 }

  SHOP_BUY:
    id: 252
    session: 32
    direction: C2S
    payload:
      - { name: npc_id, type: i32 }
      - { name: item_id, type: i32 }
      - { name: count, type: i16 }
    total_size: 10

  SHOP_SELL:
    id: 253
    session: 32
    direction: C2S
    payload:
      - { name: slot, type: u8 }
      - { name: count, type: i16 }
    total_size: 3

  SHOP_RESULT:
    id: 254
    session: 32
    direction: S2C
    payload:
      - { name: result, type: u8, enum: ShopResult }
      - { name: action, type: u8, enum: ShopAction }
      - { name: item_id, type: i32 }
      - { name: count, type: i16 }
      - { name: gold, type: i32 }
    total_size: 12

# Session 33: Skill Expansion
  SKILL_LEVEL_UP:
    id: 260
    session: 33
    direction: C2S
    payload:
      - { name: skill_id, type: i32 }
    total_size: 4

  SKILL_LEVEL_UP_RESULT:
    id: 261
    session: 33
    direction: S2C
    payload:
      - { name: result, type: u8, enum: SkillLevelUpResult }
      - { name: skill_id, type: i32 }
      - { name: new_level, type: u8 }
      - { name: skill_points, type: i32 }
    total_size: 10

  SKILL_POINT_INFO:
    id: 262
    session: 33
    direction: S2C
    payload:
      - { name: skill_points, type: i32 }
      - { name: total_spent, type: i32 }
    total_size: 8

# Session 33 Notes:
# - SKILL_LIST_RESP format expanded: +skill_level(1)+effect(1)+min_level(4) per entry = 43 bytes/skill
# - All skills now have min_level requirement and SkillEffect type
# - Skill levels 1-5, damage/MP/CD scaling per level
# - Skill points: +1 per level up, spend to learn/upgrade skills
# - New skills: 8→21 (Common: Dash+Provoke, Warrior: ShieldBash+Whirlwind+Warcry,
#   Archer: PoisonArrow+RainOfArrows+Snipe, Mage: Thunder+Blizzard+ManaShield+Meteor)

# ============================================================
# Session 34: Boss Mechanics
# ============================================================

  BOSS_SPAWN:
    id: 270
    session: 34
    direction: S2C
    payload:
      - { name: entity, type: u64 }
      - { name: boss_id, type: i32 }
      - { name: name, type: string_fixed, size: 32 }
      - { name: level, type: i32 }
      - { name: hp, type: i32 }
      - { name: max_hp, type: i32 }
      - { name: atk, type: i32 }
      - { name: def, type: i32 }
      - { name: x, type: f32 }
      - { name: y, type: f32 }
      - { name: z, type: f32 }
      - { name: phase_count, type: u8 }
      - { name: enrage_time, type: f32 }
    total_size: 73
    note: "Sent alongside MONSTER_SPAWN for boss entities. boss_id maps to BossTemplate."

  BOSS_PHASE_CHANGE:
    id: 271
    session: 34
    direction: S2C
    payload:
      - { name: boss_entity, type: u64 }
      - { name: new_phase, type: u8 }
      - { name: hp_percent, type: f32 }
      - { name: atk_multiplier, type: i32 }
      - { name: special_type, type: u8, enum: BossAttackType }
    total_size: 18
    note: "Broadcast to all players in boss zone when HP crosses phase threshold."

  BOSS_SPECIAL_ATTACK:
    id: 272
    session: 34
    direction: S2C
    payload:
      - { name: boss_entity, type: u64 }
      - { name: attack_type, type: u8, enum: BossAttackType }
      - { name: damage, type: i32 }
      - { name: targets_hit, type: u8 }
    total_size: 14
    note: "Broadcast when boss uses special attack. Damages all players in zone."

  BOSS_ENRAGE:
    id: 273
    session: 34
    direction: S2C
    payload:
      - { name: boss_entity, type: u64 }
      - { name: new_atk, type: i32 }
      - { name: atk_bonus_pct, type: i32 }
    total_size: 16
    note: "Broadcast when boss enrage timer expires. ATK permanently increased."

  BOSS_DEFEATED:
    id: 274
    session: 34
    direction: S2C
    payload:
      - { name: boss_entity, type: u64 }
      - { name: boss_id, type: i32 }
      - { name: killer_entity, type: u64 }
      - { name: loot_table_id, type: i32 }
    total_size: 24
    note: "Broadcast when boss is killed. Client can trigger victory UI + loot roll."

# Session 34 Notes:
# - 3 Bosses: AncientGolem(100, Zone2, Lv25, 3000HP, 2 phases),
#   Dragon(101, Zone3, Lv30, 5000HP, 3 phases), DemonKing(102, Zone3, Lv40, 8000HP, 3 phases)
# - HP% phase transitions: 100%→Phase1, 50-70%→Phase2, 40%→Phase3
# - Each phase: ATK multiplier (100-200%), special attack type, special cooldown
# - Enrage timer: 180-300s from combat start, adds 50-100% ATK permanently
# - Special attacks: GROUND_SLAM, FIRE_BREATH, TAIL_SWIPE, SUMMON_ADDS, STOMP, DARK_NOVA
# - Boss entities also have MonsterComponent (reuse monster AI for basic attack)
# - Respawn resets: phase→0, enrage→false, ATK→base, timers→initial

# ============================================================
# Game Data (for mock_server.py)
# ============================================================

game_data:
  accounts:
    - { id: 1, username: "hero", password: "pass123" }
    - { id: 2, username: "mage", password: "magic456" }

  characters:
    - { id: 100, account_id: 1, name: "Warrior1", level: 10, job: 1 }
    - { id: 101, account_id: 1, name: "Mage1", level: 5, job: 2 }
    - { id: 200, account_id: 2, name: "Archer2", level: 8, job: 3 }

  zones:
    - { id: 1, name: "Starting Village" }
    - { id: 2, name: "Dark Forest" }
    - { id: 3, name: "Crystal Cave" }

  monsters:
    - { id: 1001, name: "Slime", level: 1, hp: 50, atk: 5, def: 2 }
    - { id: 1002, name: "Wolf", level: 3, hp: 120, atk: 15, def: 8 }
    - { id: 1003, name: "Dragon", level: 20, hp: 5000, atk: 200, def: 100 }

  skills:
    - { id: 1, name: "Slash", cd_ms: 1000, dmg: 20, mp: 5, range: 3, type: 0 }
    - { id: 2, name: "Fireball", cd_ms: 3000, dmg: 50, mp: 20, range: 10, type: 1 }
    - { id: 3, name: "Heal", cd_ms: 5000, dmg: -30, mp: 15, range: 8, type: 2 }

  buffs:
    - { id: 1, name: "ATK_UP", duration_ms: 30000, stat: "atk", value: 10 }
    - { id: 2, name: "DEF_UP", duration_ms: 30000, stat: "def", value: 10 }
    - { id: 3, name: "POISON", duration_ms: 10000, stat: "hp", value: -5, tick_ms: 2000 }

  loot_tables:
    - table_id: 1
      drops:
        - { item_id: 2001, weight: 50, min: 1, max: 3 }
        - { item_id: 2002, weight: 30, min: 1, max: 1 }
        - { item_id: 2003, weight: 20, min: 1, max: 1 }

  quests:
    - { id: 1, name: "Kill 5 Slimes", type: "kill", target_monster: 1001, target_count: 5, reward_exp: 100, reward_item: 2001, reward_count: 3, min_level: 1 }
    - { id: 2, name: "Collect 3 Wolf Pelts", type: "collect", target_item: 2002, target_count: 3, reward_exp: 250, reward_item: 2003, reward_count: 1, min_level: 3 }
