# ============================================================
# SECRET REALM SYSTEM (비경 탐험) — 랜덤 챌린지 던전
# Reference: Genshin Impact 비경 / Lost Ark 카오스 게이트 / 무협 비경 탐험
# Synergy: world.yaml(날씨/시간), dungeon.yaml, crafting.yaml, tripod.yaml
# ============================================================

# ──────────────────────────────────────────────────────────
# 1. 비경 기본 규칙
# ──────────────────────────────────────────────────────────
secret_realm:
  desc: |
    월드 필드에 랜덤으로 출현하는 비경(秘境) 포탈.
    솔로 또는 2인용 짧은 챌린지 던전 (3~5분 시간제한).
    5가지 유형이 있으며, 날씨+시간 조합으로 특수 비경 출현.
    클리어 등급(S/A/B/C)에 따라 보상 차등.

  unlock_level: 20
  daily_limit: 3                 # 일일 3회 입장 제한
  reset: "06:00"                 # DAILY_RESET 연동
  party_size: [1, 2]             # 솔로 또는 2인

  # 포탈 출현 규칙
  spawn:
    interval: [300, 900]         # 5~15분 주기
    per_zone: 1                  # 존당 최대 1개
    duration: 300                # 출현 후 5분간 유지 (미입장 시 소멸)
    eligible_zones: [1, 2, 3, 4, 5, 6, 7]  # 필드 존만 (마을/투기장 제외)
    visual: "동양풍 회전 문양 포탈 (보라색 빛)"
    minimap_icon: "purple_diamond"
    notification: "zone_broadcast"  # 같은 존 플레이어에게 알림

# ──────────────────────────────────────────────────────────
# 2. 비경 5가지 유형
# ──────────────────────────────────────────────────────────
realm_types:
  trial:
    name: "시련의 방"
    icon: "sword_icon"
    desc: "웨이브 형식 전투 챌린지. 5웨이브 생존."
    time_limit: 300              # 5분
    mechanics:
      waves: 5
      wave_monsters: [3, 5, 7, 10, 1]  # 마지막은 미니보스
      rest_between_waves: 5      # 웨이브 간 5초 휴식
      monster_level: "player_level + 2"
    grade_criteria: "clear_time"
    grade_thresholds:
      S: 180                     # 3분 이내
      A: 240                     # 4분 이내
      B: 280                     # 4분 40초 이내
      C: 300                     # 클리어만 하면
    rewards:
      S: { gold: 3000, equipment_box: "rare+", scroll_chance: 0.3 }
      A: { gold: 2000, equipment_box: "uncommon+", scroll_chance: 0.1 }
      B: { gold: 1000, materials: 5 }
      C: { gold: 500, materials: 2 }

  wisdom:
    name: "지혜의 방"
    icon: "book_icon"
    desc: "퍼즐/기믹 챌린지. 함정 회피 + 레버 퍼즐."
    time_limit: 240              # 4분
    mechanics:
      puzzle_types: ["lever_sequence", "floor_pattern", "symbol_match", "pressure_plate"]
      traps: ["spike_floor", "arrow_wall", "poison_gas", "falling_rocks"]
      puzzles_per_room: 3
      hint_system: true          # 2분 경과 시 힌트 표시
    grade_criteria: "clear_time + hints_used"
    grade_thresholds:
      S: { time: 120, hints: 0 }
      A: { time: 180, hints: 1 }
      B: { time: 240, hints: 2 }
      C: { time: 240, hints: 3 }
    rewards:
      S: { gold: 2000, crafting_materials: "rare", scroll_chance: 0.2 }
      A: { gold: 1500, crafting_materials: "uncommon" }
      B: { gold: 800, crafting_materials: "common" }
      C: { gold: 400 }

  treasure:
    name: "보물의 방"
    icon: "chest_icon"
    desc: "파쿠르 + 수집 챌린지. 제한시간 내 보물 상자 최대한 열기."
    time_limit: 180              # 3분
    mechanics:
      chest_count: 20
      chest_locations: "플랫폼 점프 + 숨겨진 곳"
      trap_chests: 3             # 함정 상자 (데미지)
      golden_chest: 1            # 황금 상자 (대박 보상, 가장 어려운 곳)
    grade_criteria: "chests_opened"
    grade_thresholds:
      S: 18                      # 18개 이상
      A: 14
      B: 10
      C: 5
    rewards:
      S: { gold: 5000, random_items: 5, golden_chest_bonus: "epic_item" }
      A: { gold: 3000, random_items: 3 }
      B: { gold: 1500, random_items: 2 }
      C: { gold: 500, random_items: 1 }

  training:
    name: "수련의 방"
    icon: "meditation_icon"
    desc: "스킬 연마 챌린지. 콤보/회피/스킬 패턴 완벽 수행."
    time_limit: 300              # 5분
    mechanics:
      phases:
        - { name: "콤보 연습", desc: "4타 콤보 10회 연속 성공", count: 10 }
        - { name: "회피 연습", desc: "보스 패턴 회피 5회 연속", count: 5 }
        - { name: "스킬 연쇄", desc: "지정 스킬 순서대로 시전", count: 3 }
      fail_penalty: "해당 페이즈 처음부터"
    grade_criteria: "completion + fail_count"
    grade_thresholds:
      S: { fails: 0 }
      A: { fails: 2 }
      B: { fails: 5 }
      C: { completed: true }
    rewards:
      S: { exp: 5000, scroll_guaranteed: "tier_1~2", skill_point: 1 }
      A: { exp: 3000, scroll_chance: 0.5 }
      B: { exp: 2000 }
      C: { exp: 1000 }

  fortune:
    name: "운명의 방"
    icon: "dice_icon"
    desc: "랜덤 보상 룸. 선택지 기반 도박/행운 챌린지."
    time_limit: 120              # 2분
    mechanics:
      choices: 5                 # 5번의 선택
      choice_types:
        - "상자 3개 중 1개 선택 (2개 꽝, 1개 보상)"
        - "동전 던지기 (앞면: 보상 2배, 뒷면: 0)"
        - "룰렛 (6칸: 대박 1, 중박 2, 소박 2, 꽝 1)"
        - "몬스터 택 1 (3마리 중 1마리만 보물 드롭)"
        - "최종 선택: 지금까지 보상 확정 vs 올인 도박"
    grade_criteria: "luck_score"  # 누적 보상 점수 기반
    rewards:
      jackpot: { gold: 20000, legendary_material: 1, title_temp: "행운아" }
      good: { gold: 5000, rare_material: 3 }
      normal: { gold: 1000, materials: 5 }
      bad: { gold: 100, consolation: "위로 포션 1개" }

# ──────────────────────────────────────────────────────────
# 3. 날씨/시간 특수 비경
# ──────────────────────────────────────────────────────────
special_conditions:
  desc: "특정 날씨+시간 조합에서만 출현하는 특수 비경"

  conditions:
    night_fog:
      weather: "fog"
      time: "night"
      realm: "ghost_trial"
      name: "유령의 시련"
      desc: "시야 극도 제한 + 유령 몬스터. S등급 시 epic 비급 확정."
      bonus_reward_multiplier: 2.0

    storm_noon:
      weather: "storm"
      time: "noon"
      realm: "thunder_training"
      name: "뇌신의 수련장"
      desc: "번개 원소 강화 환경. 번개 스킬 스크롤 드롭률 UP."
      bonus_reward_multiplier: 1.5

    snow_dawn:
      weather: "snow"
      time: "dawn"
      realm: "crystal_treasure"
      name: "수정 보물고"
      desc: "얼음 결정 테마 보물의 방. 보석 드롭 보너스."
      bonus_reward_multiplier: 1.5

    clear_evening:
      weather: "clear"
      time: "evening"
      realm: "fortune_garden"
      name: "운명의 정원"
      desc: "특별 운명의 방. 잭팟 확률 2배."
      bonus_reward_multiplier: 1.5

  spawn_chance_when_condition_met: 0.5  # 조건 충족 시 50% 확률 즉시 스폰

# ──────────────────────────────────────────────────────────
# 4. 비경 발견 도감
# ──────────────────────────────────────────────────────────
collection:
  desc: "비경 종류별 클리어 기록"
  categories:
    trial_master:
      condition: "시련의 방 S등급 10회"
      bonus: { atk: 15 }
      title: "시련의 패자"
    wisdom_master:
      condition: "지혜의 방 S등급 10회"
      bonus: { int: 15 }
      title: "지혜의 현자"
    treasure_master:
      condition: "보물의 방 S등급 10회"
      bonus: { luk: 15 }
      title: "보물 사냥꾼"
    training_master:
      condition: "수련의 방 S등급 10회"
      bonus: { all_stats: 3 }
      title: "무예의 달인"
    fortune_master:
      condition: "운명의 방 잭팟 3회"
      bonus: { luk: 20 }
      title: "운명의 총아"
    all_complete:
      condition: "모든 비경 마스터 달성"
      bonus: { all_stats: 5, title: "비경 정복자", cosmetic: "비경 오라" }
