# ============================================================
# Client Agent 영속 상태 — 세션 간 컨텍스트 유지용
# agent_loop.py가 Claude 실행 시 이 파일을 강제 주입
# 매 작업 완료 후 Claude가 이 파일을 업데이트
# ============================================================

agent: client
project_root: "C:\\Users\\명승호\\Desktop\\ECS"
last_session: "2026-02-15T18:30:00"

# ── 현재 상태 ──
current_status: "Phase 5 클라이언트 구현 완료 — CashShop/BattlePass/Weather/Teleport/Mount/Attendance/Story 7매니저 + 7UI + 패킷 44종(474-517) + TCP 테스트 25건"

# ── 완료된 작업 ──
completed:
  - id: A1
    desc: "TPS 숄더캠 (LocalPlayer.cs 전면 리라이트)"
    files: ["Assets/Scripts/Entity/LocalPlayer.cs"]
  - id: A2
    desc: "몬스터 월드 UI (MonsterWorldUI.cs + MonsterManager 연동)"
    files: ["Assets/Scripts/UI/MonsterWorldUI.cs", "Assets/Scripts/Managers/MonsterManager.cs"]
  - id: A3
    desc: "크로스헤어 (HUDManager.cs + ProjectSetup.cs)"
    files: ["Assets/Scripts/UI/HUDManager.cs", "Assets/Editor/ProjectSetup.cs"]
  - id: A4
    desc: "키바인드 가이드 (KeybindGuideUI.cs + ProjectSetup.cs)"
    files: ["Assets/Scripts/UI/KeybindGuideUI.cs"]
  - id: A5
    desc: "자동 퀘스트 수락 (GameBootstrap.cs)"
    files: ["Assets/Scripts/GameBootstrap.cs"]
  - id: A6
    desc: "환경 개선 (포그/앰비언트/바닥색)"
    files: ["Assets/Editor/ProjectSetup.cs"]
  - id: C016
    desc: "GDD 21개 파일 교차 검증 + 에이전트 파이프라인 제안 메시지"
    files: ["_comms/client_to_server/C016_gdd_review_and_agent_pipeline_proposal.md"]
  - id: C017
    desc: "Agent Loop 자율 시스템 구축 + 서버 세팅 가이드"
    files: ["_agent/agent_loop.py", "_agent/README.md", "_context/server_state_template.yaml", "_context/ask_user.yaml", "_comms/client_to_server/C017_agent_loop_system_ready.md"]
  - id: A7
    desc: "카메라 TPS→쿼터뷰 전환 (대표님 지시, camera.yaml 기반)"
    files: ["Assets/Scripts/Entity/LocalPlayer.cs"]
  - id: A8
    desc: "HUD ui.yaml 기반 리뉴얼 + 크로스헤어 제거"
    files: ["Assets/Scripts/UI/HUDManager.cs", "Assets/Editor/ProjectSetup.cs", "Assets/Scripts/UI/KeybindGuideUI.cs"]
  - id: C018
    desc: "S031 응답 — 카메라 전환 + HUD 리뉴얼 완료 보고"
    files: ["_comms/client_to_server/C018_s031_response_camera_converted_hud_renewed.md"]
  - id: A9
    desc: "animation.yaml 기반 Animator 확장 — 콤보4단/대시/피격/스킬/전투 상태"
    files: ["Assets/Editor/ProjectSetup.cs", "Assets/Scripts/Entity/LocalPlayer.cs", "Assets/Scripts/Entity/MonsterEntity.cs", "Assets/Scripts/Entity/RemotePlayer.cs", "Assets/Scripts/Managers/MonsterManager.cs"]
  - id: A10
    desc: "vfx.yaml 기반 HitVFXManager — 파티클 오브젝트 풀 (일반/크리티컬)"
    files: ["Assets/Scripts/Managers/HitVFXManager.cs", "Assets/Editor/ProjectSetup.cs", "Assets/Scripts/interaction-map.yaml"]
  - id: A11
    desc: "art_style.yaml 기반 URP 라이팅/포스트프로세싱 (포그/앰비언트/디렉셔널/볼륨)"
    files: ["Assets/Editor/ProjectSetup.cs"]
  - id: A12
    desc: "SceneFlowManager 구현 (P0_S01_C02) — 씬 전환 싱글톤 + 페이드 트랜지션"
    files: ["Assets/Scripts/Managers/SceneFlowManager.cs", "Assets/Editor/ProjectSetup.cs", "Assets/Editor/SceneValidator.cs", "Assets/Scripts/interaction-map.yaml"]
  - id: A13
    desc: "S033/S034 패킷 연동 — 서버선택/캐릭터CRUD/튜토리얼/NPC대화/강화"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/NpcManager.cs"
      - "Assets/Scripts/Managers/EnhanceManager.cs"
      - "Assets/Scripts/Managers/TutorialManager.cs"
      - "Assets/Scripts/UI/NpcDialogUI.cs"
      - "Assets/Scripts/UI/EnhanceUI.cs"
      - "Assets/Scripts/UI/ServerSelectUI.cs"
      - "Assets/Scripts/UI/CharacterSelectUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
  - id: A14
    desc: "S029 문파/거래/우편 패킷 연동 — Guild(290-299)/Trade(300-307)/Mail(310-318)"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/GuildManager.cs"
      - "Assets/Scripts/Managers/TradeManager.cs"
      - "Assets/Scripts/Managers/MailManager.cs"
      - "Assets/Scripts/UI/GuildUI.cs"
      - "Assets/Scripts/UI/TradeUI.cs"
      - "Assets/Scripts/UI/MailUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
  - id: A15
    desc: "Phase 2 TCP 브릿지 연동 테스트 — 20/20 PASS"
    files:
      - "UnityClient/GameClient/test_tcp_bridge_client.py"
  - id: A16
    desc: "Phase 3 던전/PvP 매니저+UI — DungeonManager/PvPManager + DungeonUI/PvPUI"
    files:
      - "Assets/Scripts/Managers/DungeonManager.cs"
      - "Assets/Scripts/Managers/PvPManager.cs"
      - "Assets/Scripts/UI/DungeonUI.cs"
      - "Assets/Scripts/UI/PvPUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
      - "UnityClient/GameClient/test_tcp_bridge_client.py"
  - id: A17
    desc: "S040 Phase 3 브릿지 연동 테스트 25/25 ALL PASS + MATCH_ENQUEUE 테스트 수정"
    files:
      - "UnityClient/GameClient/test_tcp_bridge_client.py"
  - id: A18
    desc: "S041 Phase 4 Batch 1 — CraftingManager/GatheringManager/GemManager + UI 3종 + 패킷 16종(380-389,450-453)"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/CraftingManager.cs"
      - "Assets/Scripts/Managers/GatheringManager.cs"
      - "Assets/Scripts/Managers/GemManager.cs"
      - "Assets/Scripts/UI/CraftingUI.cs"
      - "Assets/Scripts/UI/GatheringUI.cs"
      - "Assets/Scripts/UI/GemUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
      - "UnityClient/GameClient/test_phase4_crafting_tcp.py"
  - id: A19
    desc: "S042 Phase 5 — 7매니저(CashShop/BattlePass/Weather/Teleport/Mount/Attendance/Story) + 7UI + 패킷44종(474-517) + TCP테스트25건"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/CashShopManager.cs"
      - "Assets/Scripts/Managers/BattlePassManager.cs"
      - "Assets/Scripts/Managers/WeatherManager.cs"
      - "Assets/Scripts/Managers/TeleportManager.cs"
      - "Assets/Scripts/Managers/MountManager.cs"
      - "Assets/Scripts/Managers/AttendanceManager.cs"
      - "Assets/Scripts/Managers/StoryManager.cs"
      - "Assets/Scripts/UI/CashShopUI.cs"
      - "Assets/Scripts/UI/BattlePassUI.cs"
      - "Assets/Scripts/UI/TeleportUI.cs"
      - "Assets/Scripts/UI/MountUI.cs"
      - "Assets/Scripts/UI/AttendanceUI.cs"
      - "Assets/Scripts/UI/ContentUnlockUI.cs"
      - "Assets/Scripts/UI/StoryUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
      - "UnityClient/GameClient/test_phase5_world_tcp.py"

# ── 대기 중 (서버 응답 필요) ──
blocked: []

# ── 다음 할 일 (blocked 아닌 것부터) ──
pending_tasks:
  - id: "phase3_raid_ui"
    desc: "레이드 전용 UI — 레이드 보스 페이즈/기믹 가이드 패널"
    priority: P2
    blocked: false
    blocked_reason: ""
  - id: "unity_play_integration"
    desc: "Unity Play 모드 실연동 — ConnectionTest.cs 전체 시퀀스 자동화"
    priority: P2
    blocked: false
    blocked_reason: ""
  - id: "gdd_task2_crafting_ui"
    desc: "제작/채집 UI — CraftingUI + GatheringUI (서버 TASK 2 MsgType 380-389)"
    priority: P1
    blocked: false
    blocked_reason: "완료 (A18)"
    status: done
  - id: "gdd_task8_gem_ui"
    desc: "보석 UI — GemUI (서버 TASK 8 MsgType 450-453)"
    priority: P1
    blocked: false
    blocked_reason: "완료 (A18)"
    status: done
  - id: "gdd_task11_cashshop_ui"
    desc: "캐시샵/배틀패스/이벤트 UI — CashShopUI + BattlePassUI (서버 TASK 11 MsgType 474-489)"
    priority: P1
    blocked: false
    blocked_reason: "완료 (A19)"
    status: done
  - id: "gdd_task12_world_ui"
    desc: "월드 시스템 UI — WeatherManager + TeleportUI + MountUI (서버 TASK 12 MsgType 490-501)"
    priority: P1
    blocked: false
    blocked_reason: "완료 (A19)"
    status: done
  - id: "gdd_task13_attendance_ui"
    desc: "출석/리셋/컨텐츠해금 UI — AttendanceUI + ContentUnlockUI (서버 TASK 13 MsgType 502-509)"
    priority: P1
    blocked: false
    blocked_reason: "완료 (A19)"
    status: done
  - id: "gdd_task14_story_ui"
    desc: "스토리/대화 UI — StoryUI (서버 TASK 14 MsgType 510-517)"
    priority: P1
    blocked: false
    blocked_reason: "완료 (A19)"
    status: done
  - id: "gdd_task3_auction_ui"
    desc: "거래소 UI — AuctionUI (서버 TASK 3 MsgType 390-397)"
    priority: P1
    blocked: true
    blocked_reason: "서버 TASK 3 (거래소 핸들러) 구현 대기 — Batch 2"
  - id: "gdd_task10_currency_ui"
    desc: "화폐/재화 UI — CurrencyUI (서버 TASK 10 MsgType 468-473)"
    priority: P1
    blocked: true
    blocked_reason: "서버 TASK 10 (화폐 핸들러) 구현 대기 — Batch 2"
  - id: "gdd_task4_daily_quest_ui"
    desc: "일일/주간 퀘스트 UI — DailyQuestUI + ReputationUI (서버 TASK 4 MsgType 400-405)"
    priority: P1
    blocked: true
    blocked_reason: "서버 TASK 4 (일일/주간 퀘스트 핸들러) 구현 대기 — Batch 3"
  - id: "gdd_task7_progression_ui"
    desc: "칭호/도감 UI — TitleUI + CollectionUI + JobChangeUI (서버 TASK 7 MsgType 440-447)"
    priority: P2
    blocked: true
    blocked_reason: "서버 TASK 7 (칭호/도감/2차전직 핸들러) 구현 대기 — Batch 3"
  - id: "gdd_task9_durability_ui"
    desc: "내구도 UI — DurabilityUI (서버 TASK 9 MsgType 462-467)"
    priority: P1
    blocked: true
    blocked_reason: "서버 TASK 9 (내구도 핸들러) 구현 대기 — Batch 3"
  - id: "gdd_task5_social_ui"
    desc: "소셜 UI — FriendUI + PartyFinderUI (서버 TASK 5 MsgType 410-422)"
    priority: P2
    blocked: true
    blocked_reason: "서버 TASK 5 (친구/차단/파티찾기 핸들러) 구현 대기 — Batch 4"
  - id: "gdd_task6_pvp_extended_ui"
    desc: "전장/길드전 UI — BattlegroundUI + GuildWarUI (서버 TASK 6 MsgType 430-435)"
    priority: P2
    blocked: true
    blocked_reason: "서버 TASK 6 (전장/길드전 핸들러) 구현 대기 — Batch 4"

# ── 최근 중요 결정 ──
recent_decisions:
  - "대표님 직접 지시: 카메라 탑다운 쿼터뷰 확정 (로아 스타일)"
  - "TPS 숄더캠 제거, camera.yaml 기반 쿼터뷰 구현"
  - "GDD 크로스파일 불일치 8건 서버에서 수정 완료"
  - "엔티티 파이프라인 제안 보류 (현재 YAML 구조 유지)"
  - "모든 코드는 validate_all.py --skip-unity 통과 필수"
  - "Agent Loop 시스템으로 자율 소통 체계 구축 완료"
  - "GDD 권위(Authority) 기준 정립 (flow.yaml=키바인딩, ui.yaml=UI, 등)"
  - "Animator 12파라미터/11상태 확장 (animation.yaml 기반 콤보/대시/피격/스킬)"
  - "HitVFXManager Reflection 기반 Volume 설정 (URP 직접 참조 대신)"
  - "크리티컬 판정 임시 기준: Damage>=50 (서버 IsCritical 필드 추가 전)"
  - "SSAO는 Renderer Feature이므로 Volume이 아닌 URP Asset 설정 필요 → 추후"
  - "SceneFlowManager 선행 구현 — 모든 씬의 기반이므로 어떤 우선순위든 필요"
  - "S033 패킷 연동: SERVER_LIST(320-321), CHARACTER_CRUD(322-327), TUTORIAL(330-331)"
  - "S034 패킷 연동: NPC_INTERACT(332), NPC_DIALOG(333), ENHANCE(340-341)"
  - "S029 패킷 연동: GUILD(290-299), TRADE(300-307), MAIL(310-318)"
  - "Phase 2 TCP 브릿지 연동 테스트 20/20 PASS — 역사적 첫 실연동 성공"
  - "Phase 3 던전/PvP 매니저 구현 — Instance(170-174)/Match(180-184) 기존 패킷 활용"
  - "Hub v2.0 이벤트 기반 시스템 확인 — agent_loop.py에서 hub.py로 전환"
  - "Phase 3 브릿지 연동 25/25 ALL PASS — 서버 46/46 + 클라 25/25 = 71/71 PASS"
  - "GDD 심화 태스크 42개→55개→80개 확인 — 서버 구현 순서대로 클라 UI 대응"
  - "ENHANCE_RESULT(341) vs ENCHANT_RESULT(389) — 별도 시스템 (기본강화 vs 원소인챈트)"
  - "Phase 4 Batch 1: Crafting(380-389) + Gem(450-453) 클라 구현 완료"
  - "Phase 5: CashShop(474-489) + World(490-501) + Attendance(502-509) + Story(510-517) 클라 구현 완료"
  - "Batch 순서: B1=제작+보석(done), B2=거래소+화폐, B3=퀘스트+직업+내구도, B4=소셜+전장"

# ── 처리된 서버 메시지 ──
processed_messages:
  - "S001"
  - "S002"
  - "S003"
  - "S004"
  - "S005"
  - "S006"
  - "S007"
  - "S008"
  - "S009"
  - "S010"
  - "S011"
  - "S012"
  - "S013"
  - "S014"
  - "S015"
  - "S016"
  - "S017"
  - "S018"
  - "S019"
  - "S020"
  - "S021"
  - "S022"
  - "S023"
  - "S024"
  - "S025"
  - "S026"
  - "S027"
  - "S028"
  - "S029"
  - "S030"
  - "S031"
  - "S033"
  - "S034"
  - "S035"
  - "S038"
  - "S039"
  - "S040"
  - "S041"
  - "S042"

# ── 핵심 규칙 (매 세션 리마인드) ──
rules:
  - "Find/FindObjectOfType 런타임 사용 금지"
  - "모든 매니저는 싱글톤 패턴 + OnDestroy 이벤트 해제"
  - "Network 네임스페이스 클래스만 namespace Network 사용"
  - "작업 후 반드시 python validate_all.py --skip-unity 실행"
  - "Old Input System API만 사용 (New Input System 아님)"
  - "UI 스크립트는 UI/ 폴더, 매니저는 Managers/ 폴더"
