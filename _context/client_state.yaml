# ============================================================
# Client Agent 영속 상태 — 세션 간 컨텍스트 유지용
# agent_loop.py가 Claude 실행 시 이 파일을 강제 주입
# 매 작업 완료 후 Claude가 이 파일을 업데이트
# ============================================================

agent: client
project_root: "C:\\Users\\명승호\\Desktop\\ECS"
last_session: "2026-02-15T03:30:00"

# ── 현재 상태 ──
current_status: "S041 처리 완료 — 클라이언트 TCP 테스트 36/36 PASS + PacketBuilder T031 중복 제거 (59 PASS / 0 FAIL)"

# ── 완료된 작업 ──
completed:
  - id: A1
    desc: "TPS 숄더캠 (LocalPlayer.cs 전면 리라이트)"
    files: ["Assets/Scripts/Entity/LocalPlayer.cs"]
  - id: A2
    desc: "몬스터 월드 UI (MonsterWorldUI.cs + MonsterManager 연동)"
    files: ["Assets/Scripts/UI/MonsterWorldUI.cs", "Assets/Scripts/Managers/MonsterManager.cs"]
  - id: A3
    desc: "크로스헤어 (HUDManager.cs + ProjectSetup.cs)"
    files: ["Assets/Scripts/UI/HUDManager.cs", "Assets/Editor/ProjectSetup.cs"]
  - id: A4
    desc: "키바인드 가이드 (KeybindGuideUI.cs + ProjectSetup.cs)"
    files: ["Assets/Scripts/UI/KeybindGuideUI.cs"]
  - id: A5
    desc: "자동 퀘스트 수락 (GameBootstrap.cs)"
    files: ["Assets/Scripts/GameBootstrap.cs"]
  - id: A6
    desc: "환경 개선 (포그/앰비언트/바닥색)"
    files: ["Assets/Editor/ProjectSetup.cs"]
  - id: C016
    desc: "GDD 21개 파일 교차 검증 + 에이전트 파이프라인 제안 메시지"
    files: ["_comms/client_to_server/C016_gdd_review_and_agent_pipeline_proposal.md"]
  - id: C017
    desc: "Agent Loop 자율 시스템 구축 + 서버 세팅 가이드"
    files: ["_agent/agent_loop.py", "_agent/README.md", "_context/server_state_template.yaml", "_context/ask_user.yaml", "_comms/client_to_server/C017_agent_loop_system_ready.md"]
  - id: A7
    desc: "카메라 TPS→쿼터뷰 전환 (대표님 지시, camera.yaml 기반)"
    files: ["Assets/Scripts/Entity/LocalPlayer.cs"]
  - id: A8
    desc: "HUD ui.yaml 기반 리뉴얼 + 크로스헤어 제거"
    files: ["Assets/Scripts/UI/HUDManager.cs", "Assets/Editor/ProjectSetup.cs", "Assets/Scripts/UI/KeybindGuideUI.cs"]
  - id: C018
    desc: "S031 응답 — 카메라 전환 + HUD 리뉴얼 완료 보고"
    files: ["_comms/client_to_server/C018_s031_response_camera_converted_hud_renewed.md"]
  - id: A9
    desc: "animation.yaml 기반 Animator 확장 — 콤보4단/대시/피격/스킬/전투 상태"
    files: ["Assets/Editor/ProjectSetup.cs", "Assets/Scripts/Entity/LocalPlayer.cs", "Assets/Scripts/Entity/MonsterEntity.cs", "Assets/Scripts/Entity/RemotePlayer.cs", "Assets/Scripts/Managers/MonsterManager.cs"]
  - id: A10
    desc: "vfx.yaml 기반 HitVFXManager — 파티클 오브젝트 풀 (일반/크리티컬)"
    files: ["Assets/Scripts/Managers/HitVFXManager.cs", "Assets/Editor/ProjectSetup.cs", "Assets/Scripts/interaction-map.yaml"]
  - id: A11
    desc: "art_style.yaml 기반 URP 라이팅/포스트프로세싱 (포그/앰비언트/디렉셔널/볼륨)"
    files: ["Assets/Editor/ProjectSetup.cs"]
  - id: A12
    desc: "SceneFlowManager 구현 (P0_S01_C02) — 씬 전환 싱글톤 + 페이드 트랜지션"
    files: ["Assets/Scripts/Managers/SceneFlowManager.cs", "Assets/Editor/ProjectSetup.cs", "Assets/Editor/SceneValidator.cs", "Assets/Scripts/interaction-map.yaml"]
  - id: A13
    desc: "S033/S034 패킷 연동 — 서버선택/캐릭터CRUD/튜토리얼/NPC대화/강화"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/NpcManager.cs"
      - "Assets/Scripts/Managers/EnhanceManager.cs"
      - "Assets/Scripts/Managers/TutorialManager.cs"
      - "Assets/Scripts/UI/NpcDialogUI.cs"
      - "Assets/Scripts/UI/EnhanceUI.cs"
      - "Assets/Scripts/UI/ServerSelectUI.cs"
      - "Assets/Scripts/UI/CharacterSelectUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
  - id: A14
    desc: "S029 문파/거래/우편 패킷 연동 — Guild(290-299)/Trade(300-307)/Mail(310-318)"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/GuildManager.cs"
      - "Assets/Scripts/Managers/TradeManager.cs"
      - "Assets/Scripts/Managers/MailManager.cs"
      - "Assets/Scripts/UI/GuildUI.cs"
      - "Assets/Scripts/UI/TradeUI.cs"
      - "Assets/Scripts/UI/MailUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
  - id: A15
    desc: "Phase 2 TCP 브릿지 연동 테스트 — 20/20 PASS"
    files:
      - "UnityClient/GameClient/test_tcp_bridge_client.py"
  - id: A16
    desc: "Phase 3 던전/PvP 매니저+UI — DungeonManager/PvPManager + DungeonUI/PvPUI"
    files:
      - "Assets/Scripts/Managers/DungeonManager.cs"
      - "Assets/Scripts/Managers/PvPManager.cs"
      - "Assets/Scripts/UI/DungeonUI.cs"
      - "Assets/Scripts/UI/PvPUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
      - "UnityClient/GameClient/test_tcp_bridge_client.py"
  - id: A17
    desc: "PvP Arena 전용 패킷(350-359) 리라이트 — PvPManager/PvPUI 전면 교체"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/PvPManager.cs"
      - "Assets/Scripts/UI/PvPUI.cs"
  - id: A18
    desc: "Raid Boss 시스템(370-379) 신규 — RaidManager + RaidUI + 패킷 연동"
    files:
      - "Assets/Scripts/Network/PacketDefinitions.cs"
      - "Assets/Scripts/Network/PacketBuilder.cs"
      - "Assets/Scripts/Network/NetworkManager.cs"
      - "Assets/Scripts/Managers/RaidManager.cs"
      - "Assets/Scripts/UI/RaidUI.cs"
      - "Assets/Editor/ProjectSetup.cs"
      - "Assets/Editor/SceneValidator.cs"
      - "Assets/Scripts/interaction-map.yaml"
  - id: A19
    desc: "Phase 3 클라이언트 TCP 테스트 36/36 ALL PASS — PvP/Raid 11개 신규 + 기존 25개 수정"
    files:
      - "UnityClient/GameClient/test_tcp_bridge_client.py"
  - id: A20
    desc: "PacketBuilder.cs T031 중복 제거 — Guild/Trade/Mail 메서드 ~270줄 데드코드 삭제"
    files:
      - "Assets/Scripts/Network/PacketBuilder.cs"

# ── 대기 중 (서버 응답 필요) ──
blocked: []

# ── 다음 할 일 (blocked 아닌 것부터) ──
pending_tasks:
  - id: "unity_play_integration"
    desc: "Unity Play 모드 실연동 — ConnectionTest.cs 전체 시퀀스 자동화"
    priority: P1
    blocked: false
    blocked_reason: ""
  - id: "phase4_planning"
    desc: "Phase 4 계획 — 대표님과 다음 단계 상의"
    priority: P2
    blocked: false
    blocked_reason: ""

# ── 최근 중요 결정 ──
recent_decisions:
  - "대표님 직접 지시: 카메라 탑다운 쿼터뷰 확정 (로아 스타일)"
  - "TPS 숄더캠 제거, camera.yaml 기반 쿼터뷰 구현"
  - "GDD 크로스파일 불일치 8건 서버에서 수정 완료"
  - "엔티티 파이프라인 제안 보류 (현재 YAML 구조 유지)"
  - "모든 코드는 validate_all.py --skip-unity 통과 필수"
  - "Agent Loop 시스템으로 자율 소통 체계 구축 완료"
  - "GDD 권위(Authority) 기준 정립 (flow.yaml=키바인딩, ui.yaml=UI, 등)"
  - "Animator 12파라미터/11상태 확장 (animation.yaml 기반 콤보/대시/피격/스킬)"
  - "HitVFXManager Reflection 기반 Volume 설정 (URP 직접 참조 대신)"
  - "크리티컬 판정 임시 기준: Damage>=50 (서버 IsCritical 필드 추가 전)"
  - "SSAO는 Renderer Feature이므로 Volume이 아닌 URP Asset 설정 필요 → 추후"
  - "SceneFlowManager 선행 구현 — 모든 씬의 기반이므로 어떤 우선순위든 필요"
  - "S033 패킷 연동: SERVER_LIST(320-321), CHARACTER_CRUD(322-327), TUTORIAL(330-331)"
  - "S034 패킷 연동: NPC_INTERACT(332), NPC_DIALOG(333), ENHANCE(340-341)"
  - "S029 패킷 연동: GUILD(290-299), TRADE(300-307), MAIL(310-318)"
  - "Phase 2 TCP 브릿지 연동 테스트 20/20 PASS — 역사적 첫 실연동 성공"
  - "S040 확인: PvP 전용 패킷(350-359)으로 전면 교체, Instance/Match 재활용 폐기"
  - "Raid Boss 시스템(370-379) 신규 구현 — 3페이즈/6기믹/스태거/인레이지"
  - "S041: 서버 PvP/Raid TCP 16/16 PASS 확인, 전체 76/76"
  - "클라이언트 TCP 테스트 36/36 ALL PASS (PvP 8개 + Raid 3개 신규)"
  - "PacketBuilder.cs T031 중복 ~270줄 제거 — S029 버전만 유지"
  - "기존 테스트 21-23 수정: INSTANCE_CREATE→INSTANCE_ENTER, MATCH_ENQUEUE 포맷 갱신"

# ── 처리된 서버 메시지 ──
processed_messages:
  - "S001"
  - "S002"
  - "S003"
  - "S004"
  - "S005"
  - "S006"
  - "S007"
  - "S008"
  - "S009"
  - "S010"
  - "S011"
  - "S012"
  - "S013"
  - "S014"
  - "S015"
  - "S016"
  - "S017"
  - "S018"
  - "S019"
  - "S020"
  - "S021"
  - "S022"
  - "S023"
  - "S024"
  - "S025"
  - "S026"
  - "S027"
  - "S028"
  - "S029"
  - "S030"
  - "S031"
  - "S033"
  - "S034"
  - "S035"
  - "S038"
  - "S039"
  - "S040"
  - "S041"

# ── 핵심 규칙 (매 세션 리마인드) ──
rules:
  - "Find/FindObjectOfType 런타임 사용 금지"
  - "모든 매니저는 싱글톤 패턴 + OnDestroy 이벤트 해제"
  - "Network 네임스페이스 클래스만 namespace Network 사용"
  - "작업 후 반드시 python validate_all.py --skip-unity 실행"
  - "Old Input System API만 사용 (New Input System 아님)"
  - "UI 스크립트는 UI/ 폴더, 매니저는 Managers/ 폴더"
