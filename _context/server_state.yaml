# ============================================================
# Server Agent 영속 상태 — 세션 간 컨텍스트 유지용
# agent_loop.py가 Claude 실행 시 이 파일을 강제 주입
# 매 작업 완료 후 Claude가 이 파일을 업데이트
# ============================================================

agent: server
project_root: "C:\\Users\\gnidev0095\\OneDrive\\바탕 화면\\Lost\\GameServerSkeleton"
last_session: "2026-02-15T09:00:00"

# ── 현재 상태 ──
current_status: "C019 처리 완료. S035 응답 전송(Phase 2 TCP 테스트 가이드). 46/46 PASS. 클라 Phase 2 연동 테스트 결과 대기 중."

# ── 완료된 작업 ──
completed:
  - id: S001-S010
    desc: "초기 통신 체계 구축, protocol.yaml, Phase 0/1 협의"
    files: ["_comms/server_to_client/S001~S010"]
  - id: S011-S015
    desc: "야근 #1~5: 채팅/장비스탯/상점/스킬확장/보스메카닉"
    files: ["ChatComponents.h", "ShopComponents.h", "SkillComponents.h", "BossComponents.h"]
  - id: S016-S018
    desc: "이동검증 Model C, 몬스터 AI 6상태FSM, 데이터드리븐+핫리로드"
    files: ["MonsterAISystem.h", "GameConfig.h", "ConfigLoader.h"]
  - id: S019
    desc: "서버 현황 총정리 + 신규 패킷 23개 한방 정리"
    files: ["_comms/server_to_client/S019*"]
  - id: S020
    desc: "TCP 브릿지 서버 v1.0 구현 (asyncio, 포트 7777, 20 PASS)"
    files: ["Servers/BridgeServer/tcp_bridge.py", "test_tcp_bridge.py"]
  - id: S021-S028
    desc: "포맷 불일치 수정, enum 버그 6건 수정, 비주얼 프로토타입 에셋 안내"
    files: ["tcp_bridge.py", "test_tcp_bridge.py"]
  - id: S029
    desc: "문파/거래/우편 3대 시스템 구현 (Session 38-40, MsgType 290-318)"
    files: ["tcp_bridge.py"]
  - id: S030
    desc: "GDD 시스템 21파일 9000줄 완성"
    files: ["_gdd/rules/*.yaml", "_gdd/game_design.yaml"]
  - id: S031
    desc: "C016 응답: CEO 카메라 결정(쿼터뷰)+GDD 크로스파일 8건 수정+엔티티 파이프라인 보류"
    files: ["_gdd/rules/combat.yaml", "_gdd/rules/ui.yaml", "_gdd/rules/items.yaml", "_gdd/rules/ai_behavior.yaml", "_gdd/rules/flow.yaml", "_comms/conversation_journal.json"]
  - id: S032
    desc: "GDD 데이터 DB 5개 CSV 생성 — monsters(20종)/skills(30개)/items(50+)/quests(25개)/npcs(18명)"
    files: ["_gdd/data/monsters.csv", "_gdd/data/skills.csv", "_gdd/data/items.csv", "_gdd/data/quests.csv", "_gdd/data/npcs.csv"]
  - id: S033
    desc: "P1 패킷 3종: SERVER_LIST(320-321)/CHARACTER_CRUD(322-327)/TUTORIAL(330-331). 23/23 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch.py"]
  - id: S034
    desc: "GDD 서버 태스크 4건: 튜토리얼 몬스터(P1_S02_S01)/NPC 대화(P1_S04_S01,332-333)/마을 NPC(P1_S05_S01)/강화(P2_S02_S01,340-341). 28/28 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch_s034.py"]
  - id: S035
    desc: "GDD 서버 태스크 2건: 필드 몬스터 확장(P2_S01_S01, zone1-3 총 30마리)+던전 매칭(P2_S03_S01, MATCH/INSTANCE 핸들러 6개+던전 4종). 34/34 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch_s035.py"]
  - id: S036
    desc: "GDD P3 서버 태스크 2건: PvP 아레나(P3_S01_S01, 1v1/3v3 매칭+스탯정규화+ELO+승패판정, MsgType 350-359)+레이드 보스 기믹(P3_S02_S01, 3페이즈+기믹6종+enrage+클리어보상, MsgType 370-379). 46/46 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch_s036.py"]
  - id: S037
    desc: "인벤토리 테스트 #10 리그레션 수정 — TestClient.recv_expect() 추가로 몬스터 스폰 패킷 간섭 해결. 46/46 PASS."
    files: ["Servers/BridgeServer/_patch_s037.py"]
  - id: S035_msg
    desc: "C019 응답: S033/S034 연동 확인 + Phase 2 TCP 브릿지 테스트 가이드 전달."
    files: ["_comms/server_to_client/S035_c019_response_phase2_ready.md"]

# ── 대기 중 (클라이언트 응답 필요) ──
blocked:
  - reason: "Phase 2 TCP 브릿지 연동 테스트 — 클라가 접속해서 ECHO→LOGIN→ENTER_GAME→MOVE→CHAT 테스트 필요"
    waiting_for: "client Phase 2 test results"

# ── 다음 할 일 ──
pending_tasks:
  - id: "respond_to_client"
    desc: "클라이언트 새 메시지에 응답 (inbox 스캔 후 자동 처리)"
    priority: P0
    blocked: false
  - id: "phase2_bridge_support"
    desc: "Phase 2 TCP 브릿지 연동 — 클라 테스트 결과에 따라 버그 수정"
    priority: P0
    blocked: true
    blocked_reason: "클라이언트 테스트 결과 대기"
  - id: "entity_pipeline_review"
    desc: "C016 엔티티 파이프라인 제안 상세 검토 (Phase 2 이후)"
    priority: P3
    blocked: true
    blocked_reason: "Phase 2 완료 후"
  - id: "gdd_polish"
    desc: "GDD 서버 태스크 전부 done — 추후 밸런싱/폴리싱 대기"
    priority: P3
    blocked: true
    blocked_reason: "클라이언트 구현 + 통합 테스트 후"

# ── 최근 중요 결정 ──
recent_decisions:
  - "D009: CEO 직접 지시 — 카메라는 탑다운 쿼터뷰(Lost Ark 스타일). TPS 숄더캠 X."
  - "D010: GDD 크로스파일 권위 기준 — 전문 파일이 권위 (flow.yaml=키바인딩, pvp.yaml=PvP수치 등)"
  - "스킬 8슬롯(QWERASDF) + V궁극기 + 1-4퀵슬롯 (Lost Ark 스타일)"
  - "엔티티 파이프라인 제안: 아이디어는 좋으나 현재 보류, Phase 2 후 검토"
  - "에셋 정책: SVG/코드=Git, FBX/텍스처/오디오=로컬 직접 배치"
  - "D011: GDD data/ CSV 5종 생성 — 서버/클라 에이전트가 파싱해서 사용"
  - "D012: OneDrive 동기화 문제로 _patch.py 사용 — Edit 도구 변경이 복원되는 이슈 우회"

# ── 처리된 클라이언트 메시지 ──
processed_messages:
  - "C001"
  - "C002"
  - "C003"
  - "C004"
  - "C005"
  - "C006"
  - "C007"
  - "C008"
  - "C009"
  - "C010"
  - "C011"
  - "C012"
  - "C013"
  - "C014"
  - "C015"
  - "C016"
  - "C017"
  - "C018"
  - "C019"

# ── 핵심 규칙 (매 세션 리마인드) ──
rules:
  - "conversation_journal.json이 Single Source of Truth — 메시지 보내면 반드시 업데이트"
  - "GDD 변경 시 교차 일관성 확인 (D010 권위 기준 참조)"
  - "C++ 코드는 ECS 패턴 (Component=struct, System=ISystem)"
  - "클라이언트 메시지는 반드시 읽고 응답"
  - "state 파일 업데이트 필수 (컨텍스트 유실 방지)"
  - "conversation_style: 동료 개발자처럼 자연스럽게. 딱딱한 보고서 금지."
  - "대표님 결정 필요 시 _context/ask_user.yaml 사용"
  - "tcp_bridge.py 수정 시 _patch.py 사용 필수 (OneDrive 동기화 파일 복원 이슈)"

# ── 중요 참고: tcp_bridge.py 패칭 방법 ──
# OneDrive 동기화가 Edit 도구 변경을 되돌리는 문제가 있음
# Servers/BridgeServer/_patch.py를 사용하여 수정해야 함
# 실행: python _patch.py && python _patch_s034.py && python _patch_s035.py && python _patch_s036.py && python _patch_s037.py && python test_tcp_bridge.py
