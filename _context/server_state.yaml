# ============================================================
# Server Agent 영속 상태 — 세션 간 컨텍스트 유지용
# agent_loop.py가 Claude 실행 시 이 파일을 강제 주입
# 매 작업 완료 후 Claude가 이 파일을 업데이트
# ============================================================

agent: server
project_root: "C:\\Users\\gnidev0095\\OneDrive\\바탕 화면\\Lost\\GameServerSkeleton"
last_session: "2026-02-16T05:50:00"

# ── 현재 상태 ──
current_status: "TASK 8 보석/각인/초월 완료! 85/85 ALL PASS (S050). 보석6종5등급+각인9종3레벨+초월5단계+Pity시스템. 다음: TASK 5 소셜(410-422) or TASK 6 전장(430-435)."

# ── 완료된 작업 ──
completed:
  - id: S001-S010
    desc: "초기 통신 체계 구축, protocol.yaml, Phase 0/1 협의"
    files: ["_comms/server_to_client/S001~S010"]
  - id: S011-S015
    desc: "야근 #1~5: 채팅/장비스탯/상점/스킬확장/보스메카닉"
    files: ["ChatComponents.h", "ShopComponents.h", "SkillComponents.h", "BossComponents.h"]
  - id: S016-S018
    desc: "이동검증 Model C, 몬스터 AI 6상태FSM, 데이터드리븐+핫리로드"
    files: ["MonsterAISystem.h", "GameConfig.h", "ConfigLoader.h"]
  - id: S019
    desc: "서버 현황 총정리 + 신규 패킷 23개 한방 정리"
    files: ["_comms/server_to_client/S019*"]
  - id: S020
    desc: "TCP 브릿지 서버 v1.0 구현 (asyncio, 포트 7777, 20 PASS)"
    files: ["Servers/BridgeServer/tcp_bridge.py", "test_tcp_bridge.py"]
  - id: S021-S028
    desc: "포맷 불일치 수정, enum 버그 6건 수정, 비주얼 프로토타입 에셋 안내"
    files: ["tcp_bridge.py", "test_tcp_bridge.py"]
  - id: S029
    desc: "문파/거래/우편 3대 시스템 구현 (Session 38-40, MsgType 290-318)"
    files: ["tcp_bridge.py"]
  - id: S030
    desc: "GDD 시스템 21파일 9000줄 완성"
    files: ["_gdd/rules/*.yaml", "_gdd/game_design.yaml"]
  - id: S031
    desc: "C016 응답: CEO 카메라 결정(쿼터뷰)+GDD 크로스파일 8건 수정+엔티티 파이프라인 보류"
    files: ["_gdd/rules/combat.yaml", "_gdd/rules/ui.yaml", "_gdd/rules/items.yaml", "_gdd/rules/ai_behavior.yaml", "_gdd/rules/flow.yaml", "_comms/conversation_journal.json"]
  - id: S032
    desc: "GDD 데이터 DB 5개 CSV 생성 — monsters(20종)/skills(30개)/items(50+)/quests(25개)/npcs(18명)"
    files: ["_gdd/data/monsters.csv", "_gdd/data/skills.csv", "_gdd/data/items.csv", "_gdd/data/quests.csv", "_gdd/data/npcs.csv"]
  - id: S033
    desc: "P1 패킷 3종: SERVER_LIST(320-321)/CHARACTER_CRUD(322-327)/TUTORIAL(330-331). 23/23 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch.py"]
  - id: S034
    desc: "GDD 서버 태스크 4건: 튜토리얼 몬스터(P1_S02_S01)/NPC 대화(P1_S04_S01,332-333)/마을 NPC(P1_S05_S01)/강화(P2_S02_S01,340-341). 28/28 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch_s034.py"]
  - id: S035
    desc: "GDD 서버 태스크 2건: 필드 몬스터 확장(P2_S01_S01, zone1-3 총 30마리)+던전 매칭(P2_S03_S01, MATCH/INSTANCE 핸들러 6개+던전 4종). 34/34 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch_s035.py"]
  - id: S036
    desc: "GDD P3 서버 태스크 2건: PvP 아레나(P3_S01_S01, 1v1/3v3 매칭+스탯정규화+ELO+승패판정, MsgType 350-359)+레이드 보스 기믹(P3_S02_S01, 3페이즈+기믹6종+enrage+클리어보상, MsgType 370-379). 46/46 PASS."
    files: ["Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "Servers/BridgeServer/_patch_s036.py"]
  - id: S037
    desc: "인벤토리 테스트 #10 리그레션 수정 — TestClient.recv_expect() 추가로 몬스터 스폰 패킷 간섭 해결. 46/46 PASS."
    files: ["Servers/BridgeServer/_patch_s037.py"]
  - id: S035_msg
    desc: "C019 응답: S033/S034 연동 확인 + Phase 2 TCP 브릿지 테스트 가이드 전달."
    files: ["_comms/server_to_client/S035_c019_response_phase2_ready.md"]
  - id: S038
    desc: "C020 응답: Phase 2 TCP 실연동 14/14 ALL PASS. test_phase2_tcp.py 11-step 전체 통과. Phase 2 공식 완료."
    files: ["_comms/server_to_client/S038_c020_response_phase2_tcp_test_passed.md"]
  - id: S039
    desc: "Hub v2.0 이벤트 기반 시스템 전환 알림"
    files: ["_comms/server_to_client/S039_hub_v2_upgrade_event_driven.md"]
  - id: S040
    desc: "C021 응답: Phase 3 브릿지 호환성 패치 + Guild/Trade/Mail TCP 14/14 ALL PASS + GDD 심화 태스크 분해. _patch_s040.py 듀얼 포맷 5건 수정. 총 60/60 PASS."
    files: ["Servers/BridgeServer/_patch_s040.py", "Servers/BridgeServer/test_phase3_tcp.py", "_comms/server_to_client/S040_c021_response_phase3_bridge_compat.md"]
  - id: S041
    desc: "C022 응답: Phase 3 PvP/Raid TCP 연동 20/20 ALL PASS. test_phase3_pvp_raid_tcp.py 작성. 총 80/80 ALL PASS. Phase 3 완전 완료!"
    files: ["Servers/BridgeServer/test_phase3_pvp_raid_tcp.py", "_comms/server_to_client/S041_c022_response_phase3_pvp_raid_80_80.md"]
  - id: S042
    desc: "TASK 2 제작/채집/요리/인챈트 시스템 구현. MsgType 380-389. 핸들러 5개(CRAFT_LIST/CRAFT_EXECUTE/GATHER_START/COOK_EXECUTE/ENCHANT_REQ) + 테스트 10개. 56/56 ALL PASS."
    files: ["Servers/BridgeServer/_patch_s042.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py"]
  - id: S043
    desc: "C023/C023_s041/C024 응답: TASK 2 완료 알림. 클라이언트 GROUP G TASK 2 UI 작업 가능(CraftingUI/GatheringUI/CookingUI/EnchantUI). 서버 TASK 3 착수 예정."
    files: ["_comms/server_to_client/S043_c024_response_crafting_system.md"]
  - id: S044
    desc: "TASK 3 거래소 시스템 구현. MsgType 390-397. 핸들러 4개(AUCTION_LIST_REQ/REGISTER/BUY/BID) + 만료처리 + 일일골드캡 + 테스트 5개. 61/61 PASS."
    files: ["Servers/BridgeServer/_patch_s044.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py"]
  - id: S045
    desc: "C025 응답: TASK 3 거래소 완료 알림 + Phase 5 확인. 클라이언트 AuctionUI 연동 가능. 다음 TASK 15(비급) 착수 예정."
    files: ["_comms/server_to_client/S045_c025_response_auction_complete.md"]
  - id: S046
    desc: "C026 응답: TASK 15 비급&트라이포드 완료. MsgType 520-524. 핸들러3+TRIPOD_TABLE 24스킬+비급드롭/해금/도감. 66/66 ALL PASS."
    files: ["Servers/BridgeServer/_patch_s046.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "_comms/server_to_client/S046_c026_response_task15_tripod.md"]
  - id: S047
    desc: "C027 응답: TASK 16 현상금 시스템 완료. MsgType 530-537. 핸들러4(LIST/ACCEPT/COMPLETE/RANKING)+PvP현상금+토큰상점+일일생성. 71/71 ALL PASS."
    files: ["Servers/BridgeServer/_patch_s047.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "_comms/server_to_client/S047_c027_response_task16_bounty.md"]
  - id: S048
    desc: "C028 응답: TASK 4 퀘스트 심화 완료. MsgType 400-405. 핸들러3(DAILY_QUEST_LIST/WEEKLY_QUEST/REPUTATION)+일일풀8종+주간풀3종+평판2세력5티어. 75/75 ALL PASS."
    files: ["Servers/BridgeServer/_patch_s048.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "_comms/server_to_client/S048_c028_response_task4_quest_enhancement.md"]
  - id: S049
    desc: "C029 응답: TASK 7 칭호/도감/2차전직 완료. MsgType 440-447. 핸들러4(TITLE_LIST/TITLE_EQUIP/COLLECTION_QUERY/JOB_CHANGE)+칭호9종+도감4카테고리+5등급+전직6직업+마일스톤9레벨. 80/80 ALL PASS."
    files: ["Servers/BridgeServer/_patch_s049.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "_comms/server_to_client/S049_c029_response_task7_progression.md"]
  - id: S050
    desc: "C030 응답: TASK 8 보석/각인/초월 완료. MsgType 450-459. 핸들러5(GEM_EQUIP/GEM_FUSE/ENGRAVING_LIST/ENGRAVING_EQUIP/TRANSCEND)+보석6종5등급+각인9종3레벨+초월5단계+Pity(+5%/fail,max+50%). 85/85 ALL PASS."
    files: ["Servers/BridgeServer/_patch_s050.py", "Servers/BridgeServer/tcp_bridge.py", "Servers/BridgeServer/test_tcp_bridge.py", "_comms/server_to_client/S050_c030_response_task8_enhancement.md"]

# ── 대기 중 (클라이언트 응답 필요) ──
blocked: []

# ── 다음 할 일 ──
pending_tasks:

  # ============================================================
  # TASK 2: 완료! (S042) — 제작/채집/요리/인챈트 56/56 PASS
  # ============================================================

  # ============================================================
  # TASK 3: 완료! (S044) — 거래소/일일캡 61/61 PASS
  # economy_sub01~06 모두 완료
  # ============================================================

  # ============================================================
  # TASK 4: 완료! (S048) — 퀘스트 심화 75/75 PASS
  # quest_sub01~05 모두 완료
  # ============================================================

  # ============================================================
  # TASK 5: 소셜 심화 — 친구/차단/파티찾기 (GDD rules/social.yaml)
  # 길드/파티/채팅은 구현됨. 친구/차단/파티찾기는 미구현.
  # MsgType: 410-422
  # ============================================================
  - id: "social_sub01"
    desc: "FRIEND_REQUEST(410)→FRIEND_REQUEST_RESULT(411) 핸들러 — 친구 요청 보내기. max_friends:100, expire:72h."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "social_sub02"
    desc: "FRIEND_ACCEPT(412)/FRIEND_REJECT(413)/FRIEND_LIST_REQ(414)→FRIEND_LIST(415) — 수락/거절/목록. 온라인 상태 + 위치 공유."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "social_sub03"
    desc: "BLOCK_PLAYER(416)/UNBLOCK(417)/BLOCK_LIST_REQ(418)→BLOCK_LIST(419) — 차단/해제/목록. 채팅 필터 + 거래 불가."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "social_sub04"
    desc: "PARTY_FINDER_LIST(420)/PARTY_FINDER_CREATE(421)/PARTY_FINDER_JOIN(422) — 파티 찾기 게시판. categories:5종, max_listings:1."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "social_sub05"
    desc: "소셜 심화 테스트 5개 — 친구 요청/수락/목록, 차단, 파티찾기."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 6: 전장 시스템 (GDD rules/pvp.yaml battleground)
  # 1v1/3v3 아레나는 구현됨. 6v6 전장 + 길드전은 미구현.
  # MsgType: 430-435
  # ============================================================
  - id: "pvp_sub01"
    desc: "BATTLEGROUND_QUEUE(430)→BATTLEGROUND_STATUS(431) 핸들러 — 6v6 전장 매칭. capture_point(3거점) + payload(수레) 2모드."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "pvp_sub02"
    desc: "BATTLEGROUND_SCORE(432)→BATTLEGROUND_SCORE_UPDATE(433) — 실시간 점수 업데이트. 거점 점령(score_per_second:1, win_score:1000)."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "pvp_sub03"
    desc: "GUILD_WAR_DECLARE(434)→GUILD_WAR_STATUS(435) — 길드전 신청/수락. min_participants:10, 30분 제한, destroy_crystal 승리조건."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "pvp_sub04"
    desc: "PvP 시즌 리셋 로직 — season_duration:12주, soft_reset 공식. tier별 보상 우편 발송."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "pvp_sub05"
    desc: "전장/길드전 테스트 4개 — 전장 큐/점수/결과, 길드전 신청."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 7: 완료! (S049) — 칭호/도감/전직 80/80 PASS
  # progression_sub01~05 모두 완료
  # ============================================================

  # ============================================================
  # TASK 8: 완료! (S050) — 보석/각인/초월 85/85 PASS
  # enhance_sub01~06 모두 완료
  # ============================================================

  # ============================================================
  # TASK 9: 장비 내구도/수리 + 랜덤옵션 (GDD rules/items.yaml)
  # 장비 장착/해제는 구현됨. 내구도/수리/리롤은 미구현.
  # MsgType: 462-467
  # ============================================================
  - id: "durability_sub01"
    desc: "내구도 감소 로직 — 피격 시 -0.1, 사망 시 전 장비 -1.0. durability≤0이면 50% 스탯 감소(broken 상태). STAT_TAKE_DMG(93) 핸들러에 추가."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "durability_sub02"
    desc: "REPAIR_REQ(462)→REPAIR_RESULT(463) 핸들러 — 장비 수리. repair_cost = equipment_tier * (100 - current_durability) * 5. 전체 수리 옵션."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "durability_sub03"
    desc: "REROLL_REQ(464)→REROLL_RESULT(465) 핸들러 — 랜덤 옵션 재설정. cost:5000골드 + Reappraisal 아이템. 옵션 잠금(1줄, 10000골드)."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "durability_sub04"
    desc: "내구도/수리/리롤 테스트 3개 — 내구도 감소/broken 확인, 수리 비용, 리롤."
    priority: P1
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 10: 보조 화폐 시스템 (GDD rules/economy.yaml currencies)
  # 골드만 구현됨. silver/dungeon_token/pvp_token/guild_contribution 미구현.
  # MsgType: 468-473
  # ============================================================
  - id: "currency_sub01"
    desc: "CURRENCY_QUERY(468)→CURRENCY_INFO(469) 핸들러 — 전체 화폐 조회. gold/silver/dungeon_token/pvp_token/guild_contribution 5종."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "currency_sub02"
    desc: "실버 화폐 연동 — NPC 상점 포션/소모품 은화 전용 구매. SHOP_BUY(252) 핸들러에 silver 결제 분기 추가."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "currency_sub03"
    desc: "던전/PvP 토큰 — 던전 클리어 시 dungeon_token 지급 + PvP 승리 시 pvp_token 지급. 기존 RAID_CLEAR(377)/PVP_MATCH_END(356) 핸들러에 추가."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "currency_sub04"
    desc: "TOKEN_SHOP_LIST(470)→TOKEN_SHOP(471) + TOKEN_SHOP_BUY(472)→TOKEN_SHOP_BUY_RESULT(473) — 토큰 상점 (던전/PvP/길드). 토큰으로 전용 장비 교환."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "currency_sub05"
    desc: "보조 화폐 테스트 4개 — 화폐 조회, 실버 구매, 토큰 획득, 토큰 교환."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 15: 완료! (S046) — 비급&트라이포드 66/66 PASS
  # tripod_sub01~06 모두 완료
  # ============================================================

  # ============================================================
  # TASK 16: 완료! (S047) — 현상금 시스템 71/71 PASS
  # bounty_sub01~08 모두 완료
  # ============================================================

  # ============================================================
  # TASK 17: 비경 탐험 시스템 (GDD rules/secret_realm.yaml) [브레인스토밍 신규]
  # 랜덤 챌린지 던전 5종 + 날씨/시간 특수 비경
  # MsgType: 540-544
  # ============================================================
  - id: "realm_sub01"
    desc: "SECRET_REALM_SPAWN(540) 핸들러 — 비경 포탈 랜덤 스폰. 5~15분 주기, 존당 최대 1개. 존 브로드캐스트."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "realm_sub02"
    desc: "SECRET_REALM_ENTER(541)→SECRET_REALM_ENTER_RESULT(542) 핸들러 — 비경 입장. 일일 3회 제한 체크 + 솔로/2인 파티 체크 + 인스턴스 생성."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "realm_sub03"
    desc: "SECRET_REALM_COMPLETE(543) / SECRET_REALM_FAIL(544) 핸들러 — 클리어/실패 결과. 등급(S/A/B/C) 계산 + 보상 지급. 비경 유형별 등급 기준 다름."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "realm_sub04"
    desc: "날씨/시간 특수 비경 로직 — weather+time_of_day 조합 체크 → 특수 비경 50% 확률 즉시 스폰. 4종 조합(night_fog/storm_noon/snow_dawn/clear_evening)."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "realm_sub05"
    desc: "data/secret_realm_conditions.yaml 생성 — 비경 5종 몬스터/퍼즐/보상 테이블 + 특수 비경 조건표."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "realm_sub06"
    desc: "비경 테스트 4개 — 비경 스폰/입장/클리어(등급별)/실패, 일일 제한."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 18: 사제(師弟) 시스템 (GDD rules/mentorship.yaml) [브레인스토밍 신규]
  # 사부-제자 관계 + 전용 퀘스트 + 졸업
  # MsgType: 550-560
  # ============================================================
  - id: "mentor_sub01"
    desc: "MENTOR_SEARCH(550)→MENTOR_LIST(551) 핸들러 — 사부/제자 검색. 사부: Lv.40+/제자3명미만, 제자: Lv.1~20/사부없음."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "mentor_sub02"
    desc: "MENTOR_REQUEST(552)→MENTOR_REQUEST_RESULT(553) + MENTOR_ACCEPT(554)→MENTOR_ACCEPT_RESULT(555) — 사제 요청/수락/거절."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "mentor_sub03"
    desc: "MENTOR_QUEST_LIST(556)→MENTOR_QUESTS(557) 핸들러 — 사제 전용 퀘스트 3개/주. 사냥/던전/채집/탐험/보스 중 랜덤 3개. same_party 조건 체크."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "mentor_sub04"
    desc: "MENTOR_GRADUATE(558) 핸들러 — 제자 Lv.30 도달 시 자동 졸업. 양쪽 보상 지급 + 서버 브로드캐스트. 사문 기여도 500 추가."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "mentor_sub05"
    desc: "MENTOR_SHOP_LIST(559)→MENTOR_SHOP(560) 핸들러 — 사문 기여도 상점. 칭호재료/외형/비급/소모품/탈것 교환."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "mentor_sub06"
    desc: "사제 경험치 버프 로직 — 사부와 같은 파티 시 제자 EXP+30%, 솔로 EXP+10%. 사부에게 제자 처치 EXP의 10% 추가."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "mentor_sub07"
    desc: "사제 테스트 5개 — 사부검색/요청/수락, 사제퀘스트, 졸업, 기여도 상점."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # ============================================================
  # === 신규 Phase 5 태스크 (GDD 전수 스캔으로 발굴) ===
  # ============================================================
  # ============================================================

  # ============================================================
  # TASK 11: 캐시샵/배틀패스/이벤트 (GDD rules/monetization.yaml)
  # 수익화 시스템 전체 미구현. Pay-to-Convenience 원칙.
  # MsgType: 474-489
  # ============================================================
  - id: "shop_sub01"
    desc: "CASH_SHOP_LIST_REQ(474)→CASH_SHOP_LIST(475) 핸들러 — 캐시샵 카테고리별 아이템 목록 반환. cosmetics/convenience 분류. crystal 화폐 시스템."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "shop_sub02"
    desc: "CASH_SHOP_BUY(476)→CASH_SHOP_BUY_RESULT(477) 핸들러 — 크리스탈 차감 + 아이템 지급. inventory_expansion(max:6회)/storage_expansion(max:15회)/exp_boost(24h)/auto_potion(30일)."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "shop_sub03"
    desc: "BATTLEPASS_INFO_REQ(478)→BATTLEPASS_INFO(479) 핸들러 — 배틀패스 현재 레벨/경험치/보상 상태 조회. season_duration:90일, max_level:50, exp_per_level:1000."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "shop_sub04"
    desc: "BATTLEPASS_CLAIM(480)→BATTLEPASS_CLAIM_RESULT(481) 핸들러 — 무료/프리미엄 트랙 보상 수령. 레벨별 보상 테이블(5/10/15.../50). 프리미엄 구매 상태 체크."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "shop_sub05"
    desc: "배틀패스 경험치 획득 로직 — 일퀘(200)/주퀘(800)/던전클리어(100)/PvP승리(50)/로그인(50). 기존 핸들러에 BP_EXP 추가 훅."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "shop_sub06"
    desc: "EVENT_LIST_REQ(482)→EVENT_LIST(483) + EVENT_CLAIM(484)→EVENT_CLAIM_RESULT(485) — 이벤트 시스템. login_event(14일 출석)/double_exp(72h)/boss_rush(48h). 이벤트 스케줄 관리."
    priority: P2
    blocked: false
    estimated_minutes: 15

  - id: "shop_sub07"
    desc: "SUBSCRIPTION_INFO(486)→SUBSCRIPTION_STATUS(487) + SUBSCRIPTION_BUY(488)→SUBSCRIPTION_RESULT(489) — 월정액 '모험가의 축복'. exp+10%/gold+10%/daily_crystal:10/repair_discount:50%/teleport_free:3/extra_dungeon:1."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "shop_sub08"
    desc: "캐시샵/배틀패스/이벤트 테스트 6개 — 캐시 구매/BP 레벨업/BP 보상수령/이벤트 출석/구독 구매/구독 혜택."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 12: 월드 시스템 — 날씨/시간/텔레포트/파괴오브젝트 (GDD rules/world.yaml)
  # 존 이동은 구현됨. 날씨/시간/워프/오브젝트 미구현.
  # MsgType: 490-501
  # ============================================================
  - id: "world_sub01"
    desc: "WEATHER_INFO_REQ(490)→WEATHER_INFO(491) 핸들러 — 현재 날씨+시간 조회. weather_types 6종(clear/rain/snow/fog/storm/sandstorm). 5~15분 주기 자동 전환. 원소 데미지 보정(rain:fire-10%/lightning+10% 등)."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "world_sub02"
    desc: "서버측 날씨/시간 틱 시스템 — 3600초=게임내 1일 사이클. time_of_day 6구간(dawn~night). 밤: visibility-40%/monster_spawn+20%/special_monsters. 날씨 확률 전환(clear:50%/rain:20%/snow:10%/fog:10%/storm:5%/sand:5%)."
    priority: P2
    blocked: false
    estimated_minutes: 15

  - id: "world_sub03"
    desc: "TELEPORT_REQ(492)→TELEPORT_RESULT(493) 핸들러 — 워프 포인트 텔레포트. cost:silver500. cast_time:3초(피격취소). 발견한 포인트만 사용 가능. WAYPOINT_DISCOVER(494)→WAYPOINT_LIST(495) 워프 등록/목록."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "world_sub04"
    desc: "DESTROY_OBJECT(496)→DESTROY_OBJECT_RESULT(497) + INTERACT_OBJECT(498)→INTERACT_RESULT(499) — 파괴/상호작용 오브젝트. barrel(HP:10,loot:gold1-10)/crate(HP:20)/crystal(HP:50,gem:30%). treasure_chest(open_time:2s,trapped:10%). respawn 타이머."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "world_sub05"
    desc: "MOUNT_SUMMON(500)→MOUNT_RESULT(501) 핸들러 — 탈것 소환/해제. speed_multiplier:2.0, summon_cast:2초, 피격시/공격시 해제. available_from_level:20."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "world_sub06"
    desc: "월드 시스템 테스트 5개 — 날씨 조회/전환, 텔레포트, 오브젝트 파괴, 탈것 소환."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 13: 출석/로그인 보상 + 일일 리셋 (GDD rules/flow.yaml + monetization.yaml)
  # 엔드게임 일일 루틴의 서버 측 핵심 로직.
  # MsgType: 502-509
  # ============================================================
  - id: "login_sub01"
    desc: "LOGIN_REWARD_REQ(502)→LOGIN_REWARD_INFO(503) 핸들러 — 출석 보상 조회. 14일 주기 보상 테이블. 누적 일수 + 오늘 수령 여부 반환."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "login_sub02"
    desc: "LOGIN_REWARD_CLAIM(504)→LOGIN_REWARD_CLAIM_RESULT(505) 핸들러 — 출석 보상 수령. day1:gold1000 → day7:rare_box → day14:epic_box+칭호. 중복 수령 방지."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "login_sub03"
    desc: "DAILY_RESET 서버 로직 — 매일 06:00 자동 리셋: 일일퀘스트 초기화/던전 횟수 초기화/출석 카운트/골드캡 리셋/에너지 전체 회복. DAILY_RESET_NOTIFY(506) 브로드캐스트."
    priority: P1
    blocked: false
    estimated_minutes: 15

  - id: "login_sub04"
    desc: "WEEKLY_RESET 서버 로직 — 수요일 06:00 자동 리셋: 주간퀘/레이드 입장횟수/길드전 일정/PvP 시즌 포인트. WEEKLY_RESET_NOTIFY(507) 브로드캐스트."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "login_sub05"
    desc: "CONTENT_UNLOCK_NOTIFY(508) 핸들러 — 레벨 도달 시 컨텐츠 해금 알림. Lv5:일퀘/Lv10:강화+거래소/Lv15:던전/Lv20:전직+PvP+탈것/Lv25:보석/Lv30:길드+궁극기/Lv40:초월/Lv50:레이드+각인/Lv60:카오스+파라곤."
    priority: P1
    blocked: false
    estimated_minutes: 10

  - id: "login_sub06"
    desc: "출석/리셋 테스트 4개 — 출석보상 조회/수령, 일일리셋 시뮬레이션, 컨텐츠 해금."
    priority: P1
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # TASK 14: 스토리/메인퀘 대화 시스템 (GDD rules/narrative.yaml)
  # NPC 기본 대화(332-333)는 구현됨. 선택지 분기/컷씬 트리거/챕터 진행은 미구현.
  # MsgType: 510-517
  # ============================================================
  - id: "narrative_sub01"
    desc: "DIALOG_CHOICE(510)→DIALOG_CHOICE_RESULT(511) 핸들러 — NPC 대화 중 선택지 분기. player_choices 배열에서 선택 → next dialog_id 라우팅. quest_accept/lore_hint 분기 처리."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "narrative_sub02"
    desc: "CUTSCENE_TRIGGER(512)→CUTSCENE_DATA(513) 핸들러 — 스토리 컷씬 트리거. 서버에서 진행 조건 체크(chapter/quest 완료 여부) → 컷씬 시퀀스 데이터 전송. opening/boss_intro/chapter_transition 3종."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "narrative_sub03"
    desc: "CHAPTER_PROGRESS_REQ(514)→CHAPTER_PROGRESS(515) 핸들러 — 메인 스토리 챕터 진행 상태 조회. chapter 1~4 + 봉인석 파편 수집 현황(0~5). chapter_unlock 조건 체크."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "narrative_sub04"
    desc: "메인 퀘스트 데이터 로드 — narrative.yaml의 MQ001~MQ045 대사 스크립트를 서버 메모리에 로드. npc_id→dialog_tree 매핑. quest_accept/quest_complete 자동 연동."
    priority: P2
    blocked: false
    estimated_minutes: 10

  - id: "narrative_sub05"
    desc: "스토리/대화 테스트 4개 — 선택지 분기, 컷씬 트리거, 챕터 진행, 메인퀘 대사 로드."
    priority: P2
    blocked: false
    estimated_minutes: 10

  # ============================================================
  # 기존 유지 태스크
  # ============================================================
  - id: "respond_to_client"
    desc: "클라이언트 새 메시지에 응답 (inbox 스캔 후 자동 처리)"
    priority: P0
    blocked: false

  - id: "entity_pipeline_review"
    desc: "C016 엔티티 파이프라인 제안 상세 검토 (Phase 3 완료됨, 이제 검토 가능)"
    priority: P2
    blocked: false

  - id: "phase4_planning"
    desc: "Phase 4 계획 수립 — Unity Play 모드 통합 테스트 / 밸런싱 / 추가 컨텐츠"
    priority: P2
    blocked: false

  - id: "gdd_polish"
    desc: "GDD 서버 태스크 전부 done — 추후 밸런싱/폴리싱 대기"
    priority: P3
    blocked: true
    blocked_reason: "통합 테스트 + 대표님 피드백 후"

# ── 최근 중요 결정 ──
recent_decisions:
  - "D009: CEO 직접 지시 — 카메라는 탑다운 쿼터뷰(Lost Ark 스타일). TPS 숄더캠 X."
  - "D010: GDD 크로스파일 권위 기준 — 전문 파일이 권위 (flow.yaml=키바인딩, pvp.yaml=PvP수치 등)"
  - "스킬 8슬롯(QWERASDF) + V궁극기 + 1-4퀵슬롯 (Lost Ark 스타일)"
  - "엔티티 파이프라인 제안: 아이디어는 좋으나 현재 보류, Phase 2 후 검토"
  - "에셋 정책: SVG/코드=Git, FBX/텍스처/오디오=로컬 직접 배치"
  - "D011: GDD data/ CSV 5종 생성 — 서버/클라 에이전트가 파싱해서 사용"
  - "D012: OneDrive 동기화 문제로 _patch.py 사용 — Edit 도구 변경이 복원되는 이슈 우회"
  - "Phase 2 TCP 실연동 14/14 ALL PASS (2026-02-15) — 역사적인 첫 실연동"
  - "Phase 3 Guild/Trade/Mail TCP 연동 14/14 ALL PASS (2026-02-15) — 총 60/60"
  - "D013: GDD 심화 태스크 분해 — 10개 영역 55개 서브태스크 (제작/거래소/퀘스트심화/소셜/전장/칭호 + 보석각인초월/내구도수리/보조화폐)"
  - "Phase 3 PvP/Raid TCP 연동 20/20 ALL PASS (2026-02-15) — 총 80/80 ALL PASS. Phase 3 완전 완료!"
  - "D014: GDD 신규 4영역 25서브태스크 추가 분해 — 캐시샵/배틀패스(474-489), 월드시스템(490-501), 출석/리셋(502-509), 스토리/대화(510-517)"
  - "TASK 2 완료: 제작/채집/요리/인챈트(380-389) 56/56 PASS. _patch_s042.py. 레시피6종+채집3종+요리3종+인챈트6원소3단계."
  - "D015: 브레인스토밍 세션 — 4개 신규 시스템 GDD 추가: 비급&트라이포드(520-524), 강호 현상금(530-537), 비경 탐험(540-544), 사제 시스템(550-560)"
  - "신규 rules 4파일: tripod.yaml, bounty.yaml, secret_realm.yaml, mentorship.yaml"
  - "서버 TASK 15~18 추가: 비급(6sub) + 현상금(8sub) + 비경(6sub) + 사제(7sub) = 27개 서브태스크"
  - "TASK 3 완료: 거래소(390-397) 61/61 PASS. _patch_s044.py. 핸들러4(LIST/REGISTER/BUY/BID)+만료처리+일일캡. TAX:5%, FEE:100g, MAX:20건, 48h."
  - "클라 Phase 5 완료 확인: TASK 11-14 (474-517) 매니저7종+UI7종+패킷44종, 79 PASS"
  - "클라 Phase 6 거래소 완료: AuctionManager+AuctionUI, 37매니저 24UI 131패킷, 81 PASS"
  - "TASK 15 완료: 비급&트라이포드(520-524) 66/66 PASS. _patch_s046.py. TRIPOD_TABLE 24스킬*192옵션+비급드롭+해금+도감. 비급item_id=9000~9999."
  - "클라 TASK 15 완료: TripodManager+TripodUI, 83 PASS. T키 토글, 3티어 구조."
  - "TASK 16 완료: 현상금시스템(530-537) 71/71 PASS. _patch_s047.py. 핸들러4+PvP현상금+토큰상점. BOUNTY_ELITE_POOL3종+WORLD_BOSSES3종+PVP_TIERS4단계."
  - "클라 TASK 16 완료: BountyManager+BountyUI, 85 PASS. B키 토글, TCP 10건."
  - "TASK 4 완료: 퀘스트심화(400-405) 75/75 PASS. _patch_s048.py. 일일퀘풀8종+주간퀘풀3종+평판2세력5티어. DAILY_QUEST_MIN_LEVEL=5, WEEKLY_QUEST_MIN_LEVEL=15, REPUTATION_DAILY_CAP=500."
  - "클라 TASK 4 완료: DailyQuestManager+DailyQuestUI+ReputationManager+ReputationUI, 89 PASS. L키=일퀘, N키=평판."
  - "TASK 7 완료: 칭호/도감/2차전직(440-447) 80/80 PASS. _patch_s049.py. 칭호9종+도감(몬스터4카테고리+장비5등급)+전직6직업(berserker/guardian/sharpshooter/ranger/archmage/priest)+마일스톤9레벨. JOB_CHANGE_MIN_LEVEL=20."
  - "클라 TASK 7 완료: TitleManager+CollectionManager+TitleUI+CollectionUI+JobChangeUI, 93 PASS. H/F6/F7키."
  - "TASK 8 완료: 보석/각인/초월(450-459) 85/85 PASS. _patch_s050.py. 보석6종5등급(ruby/sapphire/emerald/diamond/topaz/amethyst)+각인9종3레벨(grudge/cursed_doll/keen_blunt/master_brawler/adrenaline/spirit_absorption/heavy_armor/expert/awakening)+초월5단계(50%/30%/20%/10%/5%)+Pity(+5%/fail,max+50%)."
  - "OneDrive tcp_bridge.py 잘림 이슈 발견/수정: _patch_s050.py에 git 원본 복구 로직 추가"

# ── 처리된 클라이언트 메시지 ──
processed_messages:
  - "C001"
  - "C002"
  - "C003"
  - "C004"
  - "C005"
  - "C006"
  - "C007"
  - "C008"
  - "C009"
  - "C010"
  - "C011"
  - "C012"
  - "C013"
  - "C014"
  - "C015"
  - "C016"
  - "C017"
  - "C018"
  - "C019"
  - "C020"
  - "C021"
  - "C022"
  - "C023"
  - "C023_s041"
  - "C024"
  - "C025"
  - "C025_s042"
  - "C026"
  - "C027"
  - "C028"
  - "C029"
  - "C030"

# ── 핵심 규칙 (매 세션 리마인드) ──
rules:
  - "conversation_journal.json이 Single Source of Truth — 메시지 보내면 반드시 업데이트"
  - "GDD 변경 시 교차 일관성 확인 (D010 권위 기준 참조)"
  - "C++ 코드는 ECS 패턴 (Component=struct, System=ISystem)"
  - "클라이언트 메시지는 반드시 읽고 응답"
  - "state 파일 업데이트 필수 (컨텍스트 유실 방지)"
  - "conversation_style: 동료 개발자처럼 자연스럽게. 딱딱한 보고서 금지."
  - "대표님 결정 필요 시 _context/ask_user.yaml 사용"
  - "tcp_bridge.py 수정 시 _patch.py 사용 필수 (OneDrive 동기화 파일 복원 이슈)"

# ── 중요 참고: tcp_bridge.py 패칭 방법 ──
# OneDrive 동기화가 Edit 도구 변경을 되돌리는 문제가 있음
# Servers/BridgeServer/_patch.py를 사용하여 수정해야 함
# 실행: python _patch.py && python _patch_s034.py && python _patch_s035.py && python _patch_s036.py && python _patch_s037.py && python _patch_s040.py && python _patch_s042.py && python _patch_s044.py && python _patch_s046.py && python _patch_s047.py && python _patch_s048.py && python _patch_s049.py && python test_tcp_bridge.py
